<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libacfutils: /home/diablos/NextDev/libacfutils-dll/src/helpers.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libacfutils
   </div>
   <div id="projectbrief">A general purpose library of utility functions designed to make it easier to develop addons for the X-Plane flight simulator.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">/home/diablos/NextDev/libacfutils-dll/src/helpers.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>Splits up an input string by a separator into individual components.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">input</td><td>The input string to be split up. </td></tr>
    <tr><td class="paramname">sep</td><td>The separator string. The function looks for sequences of <code>sep</code> in <code>input</code> and any portions of the input which occur between separators are split out. </td></tr>
    <tr><td class="paramname">skip_empty</td><td>This flag indicates whether to skip empty components (i.e. two occurences of the separator string which are next to each other). If set to <code>B_TRUE</code>, the resulting array will not contain empty strings where two consecutive separators were in the input. </td></tr>
    <tr><td class="paramname">num</td><td>A mandatory return parameter, which will be set to the number of components in the output array. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An array of strings and the number of components in the &lsquo;num&rsquo; return parameter. The array of strings must be freed by the caller using the free_strlist() function.</dd></dl>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> foo;</div>
</div><!-- fragment --><div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * CDDL HEADER START</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * The contents of this file are subject to the terms of the</span></div>
<div class="line"><span class="comment"> * Common Development and Distribution License, Version 1.0 only</span></div>
<div class="line"><span class="comment"> * (the &quot;License&quot;).  You may not use this file except in compliance</span></div>
<div class="line"><span class="comment"> * with the License.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * You can obtain a copy of the license in the file COPYING</span></div>
<div class="line"><span class="comment"> * or http://www.opensource.org/licenses/CDDL-1.0.</span></div>
<div class="line"><span class="comment"> * See the License for the specific language governing permissions</span></div>
<div class="line"><span class="comment"> * and limitations under the License.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * When distributing Covered Code, include this CDDL HEADER in each</span></div>
<div class="line"><span class="comment"> * file and include the License file COPYING.</span></div>
<div class="line"><span class="comment"> * If applicable, add the following below this CDDL HEADER, with the</span></div>
<div class="line"><span class="comment"> * fields enclosed by brackets &quot;[]&quot; replaced with your own identifying</span></div>
<div class="line"><span class="comment"> * information: Portions Copyright [yyyy] [name of copyright owner]</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> * CDDL HEADER END</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Copyright 2023 Saso Kiselkov. All rights reserved.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;errno.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;math.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ctype.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;zlib.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line"><span class="preprocessor">#include &lt;windows.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;strsafe.h&gt;</span></div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/types.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/time.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;sys/stat.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;dirent.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="assert_8h.html">acfutils/assert.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="helpers_8h.html">acfutils/helpers.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;acfutils/log.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="safe__alloc_8h.html">acfutils/safe_alloc.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;acfutils/stat.h&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;acfutils/time.h&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * The single-letter versions of the IDs need to go after the two-letter ones</span></div>
<div class="line"><span class="comment"> * to make sure we pick up the two-letter versions first.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *<span class="keyword">const</span> icao_country_codes[] = {</div>
<div class="line">    <span class="stringliteral">&quot;AN&quot;</span>,   <span class="stringliteral">&quot;AY&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;BG&quot;</span>,   <span class="stringliteral">&quot;BI&quot;</span>,   <span class="stringliteral">&quot;BK&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;C&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;DA&quot;</span>,   <span class="stringliteral">&quot;DB&quot;</span>,   <span class="stringliteral">&quot;DF&quot;</span>,   <span class="stringliteral">&quot;DG&quot;</span>,   <span class="stringliteral">&quot;DI&quot;</span>,   <span class="stringliteral">&quot;DN&quot;</span>,   <span class="stringliteral">&quot;DR&quot;</span>,   <span class="stringliteral">&quot;DT&quot;</span>,   <span class="stringliteral">&quot;DX&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;EB&quot;</span>,   <span class="stringliteral">&quot;ED&quot;</span>,   <span class="stringliteral">&quot;EE&quot;</span>,   <span class="stringliteral">&quot;EF&quot;</span>,   <span class="stringliteral">&quot;EG&quot;</span>,   <span class="stringliteral">&quot;EH&quot;</span>,   <span class="stringliteral">&quot;EI&quot;</span>,   <span class="stringliteral">&quot;EK&quot;</span>,   <span class="stringliteral">&quot;EL&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;EN&quot;</span>,   <span class="stringliteral">&quot;EP&quot;</span>,   <span class="stringliteral">&quot;ES&quot;</span>,   <span class="stringliteral">&quot;ET&quot;</span>,   <span class="stringliteral">&quot;EV&quot;</span>,   <span class="stringliteral">&quot;EY&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;FA&quot;</span>,   <span class="stringliteral">&quot;FB&quot;</span>,   <span class="stringliteral">&quot;FC&quot;</span>,   <span class="stringliteral">&quot;FD&quot;</span>,   <span class="stringliteral">&quot;FE&quot;</span>,   <span class="stringliteral">&quot;FG&quot;</span>,   <span class="stringliteral">&quot;FH&quot;</span>,   <span class="stringliteral">&quot;FI&quot;</span>,   <span class="stringliteral">&quot;FJ&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;FK&quot;</span>,   <span class="stringliteral">&quot;FL&quot;</span>,   <span class="stringliteral">&quot;FM&quot;</span>,   <span class="stringliteral">&quot;FN&quot;</span>,   <span class="stringliteral">&quot;FO&quot;</span>,   <span class="stringliteral">&quot;FP&quot;</span>,   <span class="stringliteral">&quot;FQ&quot;</span>,   <span class="stringliteral">&quot;FS&quot;</span>,   <span class="stringliteral">&quot;FT&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;FV&quot;</span>,   <span class="stringliteral">&quot;FW&quot;</span>,   <span class="stringliteral">&quot;FX&quot;</span>,   <span class="stringliteral">&quot;FY&quot;</span>,   <span class="stringliteral">&quot;FZ&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;GA&quot;</span>,   <span class="stringliteral">&quot;GB&quot;</span>,   <span class="stringliteral">&quot;GC&quot;</span>,   <span class="stringliteral">&quot;GE&quot;</span>,   <span class="stringliteral">&quot;GF&quot;</span>,   <span class="stringliteral">&quot;GG&quot;</span>,   <span class="stringliteral">&quot;GL&quot;</span>,   <span class="stringliteral">&quot;GM&quot;</span>,   <span class="stringliteral">&quot;GO&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;GQ&quot;</span>,   <span class="stringliteral">&quot;GS&quot;</span>,   <span class="stringliteral">&quot;GU&quot;</span>,   <span class="stringliteral">&quot;GV&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;HA&quot;</span>,   <span class="stringliteral">&quot;HB&quot;</span>,   <span class="stringliteral">&quot;HC&quot;</span>,   <span class="stringliteral">&quot;HD&quot;</span>,   <span class="stringliteral">&quot;HE&quot;</span>,   <span class="stringliteral">&quot;HH&quot;</span>,   <span class="stringliteral">&quot;HK&quot;</span>,   <span class="stringliteral">&quot;HL&quot;</span>,   <span class="stringliteral">&quot;HR&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;HS&quot;</span>,   <span class="stringliteral">&quot;HT&quot;</span>,   <span class="stringliteral">&quot;HU&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;K&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;LA&quot;</span>,   <span class="stringliteral">&quot;LB&quot;</span>,   <span class="stringliteral">&quot;LC&quot;</span>,   <span class="stringliteral">&quot;LD&quot;</span>,   <span class="stringliteral">&quot;LE&quot;</span>,   <span class="stringliteral">&quot;LF&quot;</span>,   <span class="stringliteral">&quot;LG&quot;</span>,   <span class="stringliteral">&quot;LH&quot;</span>,   <span class="stringliteral">&quot;LI&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;LJ&quot;</span>,   <span class="stringliteral">&quot;LK&quot;</span>,   <span class="stringliteral">&quot;LL&quot;</span>,   <span class="stringliteral">&quot;LM&quot;</span>,   <span class="stringliteral">&quot;LN&quot;</span>,   <span class="stringliteral">&quot;LO&quot;</span>,   <span class="stringliteral">&quot;LP&quot;</span>,   <span class="stringliteral">&quot;LQ&quot;</span>,   <span class="stringliteral">&quot;LR&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;LS&quot;</span>,   <span class="stringliteral">&quot;LT&quot;</span>,   <span class="stringliteral">&quot;LU&quot;</span>,   <span class="stringliteral">&quot;LV&quot;</span>,   <span class="stringliteral">&quot;LW&quot;</span>,   <span class="stringliteral">&quot;LX&quot;</span>,   <span class="stringliteral">&quot;LY&quot;</span>,   <span class="stringliteral">&quot;LZ&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;MB&quot;</span>,   <span class="stringliteral">&quot;MD&quot;</span>,   <span class="stringliteral">&quot;MG&quot;</span>,   <span class="stringliteral">&quot;MH&quot;</span>,   <span class="stringliteral">&quot;MK&quot;</span>,   <span class="stringliteral">&quot;MM&quot;</span>,   <span class="stringliteral">&quot;MN&quot;</span>,   <span class="stringliteral">&quot;MP&quot;</span>,   <span class="stringliteral">&quot;MR&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;MS&quot;</span>,   <span class="stringliteral">&quot;MT&quot;</span>,   <span class="stringliteral">&quot;MU&quot;</span>,   <span class="stringliteral">&quot;MW&quot;</span>,   <span class="stringliteral">&quot;MY&quot;</span>,   <span class="stringliteral">&quot;MZ&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;NC&quot;</span>,   <span class="stringliteral">&quot;NF&quot;</span>,   <span class="stringliteral">&quot;NG&quot;</span>,   <span class="stringliteral">&quot;NI&quot;</span>,   <span class="stringliteral">&quot;NL&quot;</span>,   <span class="stringliteral">&quot;NS&quot;</span>,   <span class="stringliteral">&quot;NT&quot;</span>,   <span class="stringliteral">&quot;NV&quot;</span>,   <span class="stringliteral">&quot;NW&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;NZ&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;OA&quot;</span>,   <span class="stringliteral">&quot;OB&quot;</span>,   <span class="stringliteral">&quot;OE&quot;</span>,   <span class="stringliteral">&quot;OI&quot;</span>,   <span class="stringliteral">&quot;OJ&quot;</span>,   <span class="stringliteral">&quot;OK&quot;</span>,   <span class="stringliteral">&quot;OL&quot;</span>,   <span class="stringliteral">&quot;OM&quot;</span>,   <span class="stringliteral">&quot;OO&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;OP&quot;</span>,   <span class="stringliteral">&quot;OR&quot;</span>,   <span class="stringliteral">&quot;OS&quot;</span>,   <span class="stringliteral">&quot;OT&quot;</span>,   <span class="stringliteral">&quot;OY&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;PA&quot;</span>,   <span class="stringliteral">&quot;PB&quot;</span>,   <span class="stringliteral">&quot;PC&quot;</span>,   <span class="stringliteral">&quot;PF&quot;</span>,   <span class="stringliteral">&quot;PG&quot;</span>,   <span class="stringliteral">&quot;PH&quot;</span>,   <span class="stringliteral">&quot;PJ&quot;</span>,   <span class="stringliteral">&quot;PK&quot;</span>,   <span class="stringliteral">&quot;PL&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;PM&quot;</span>,   <span class="stringliteral">&quot;PO&quot;</span>,   <span class="stringliteral">&quot;PP&quot;</span>,   <span class="stringliteral">&quot;PT&quot;</span>,   <span class="stringliteral">&quot;PW&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;RC&quot;</span>,   <span class="stringliteral">&quot;RJ&quot;</span>,   <span class="stringliteral">&quot;RK&quot;</span>,   <span class="stringliteral">&quot;RO&quot;</span>,   <span class="stringliteral">&quot;RP&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;SA&quot;</span>,   <span class="stringliteral">&quot;SB&quot;</span>,   <span class="stringliteral">&quot;SC&quot;</span>,   <span class="stringliteral">&quot;SD&quot;</span>,   <span class="stringliteral">&quot;SE&quot;</span>,   <span class="stringliteral">&quot;SF&quot;</span>,   <span class="stringliteral">&quot;SG&quot;</span>,   <span class="stringliteral">&quot;SH&quot;</span>,   <span class="stringliteral">&quot;SI&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;SJ&quot;</span>,   <span class="stringliteral">&quot;SK&quot;</span>,   <span class="stringliteral">&quot;SL&quot;</span>,   <span class="stringliteral">&quot;SM&quot;</span>,   <span class="stringliteral">&quot;SN&quot;</span>,   <span class="stringliteral">&quot;SO&quot;</span>,   <span class="stringliteral">&quot;SP&quot;</span>,   <span class="stringliteral">&quot;SS&quot;</span>,   <span class="stringliteral">&quot;SU&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;SV&quot;</span>,   <span class="stringliteral">&quot;SW&quot;</span>,   <span class="stringliteral">&quot;SY&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;TA&quot;</span>,   <span class="stringliteral">&quot;TB&quot;</span>,   <span class="stringliteral">&quot;TD&quot;</span>,   <span class="stringliteral">&quot;TF&quot;</span>,   <span class="stringliteral">&quot;TG&quot;</span>,   <span class="stringliteral">&quot;TI&quot;</span>,   <span class="stringliteral">&quot;TJ&quot;</span>,   <span class="stringliteral">&quot;TK&quot;</span>,   <span class="stringliteral">&quot;TL&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;TN&quot;</span>,   <span class="stringliteral">&quot;TQ&quot;</span>,   <span class="stringliteral">&quot;TR&quot;</span>,   <span class="stringliteral">&quot;TT&quot;</span>,   <span class="stringliteral">&quot;TU&quot;</span>,   <span class="stringliteral">&quot;TV&quot;</span>,   <span class="stringliteral">&quot;TX&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;UA&quot;</span>,   <span class="stringliteral">&quot;UB&quot;</span>,   <span class="stringliteral">&quot;UC&quot;</span>,   <span class="stringliteral">&quot;UD&quot;</span>,   <span class="stringliteral">&quot;UG&quot;</span>,   <span class="stringliteral">&quot;UK&quot;</span>,   <span class="stringliteral">&quot;UM&quot;</span>,   <span class="stringliteral">&quot;UT&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;U&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;VA&quot;</span>,   <span class="stringliteral">&quot;VC&quot;</span>,   <span class="stringliteral">&quot;VD&quot;</span>,   <span class="stringliteral">&quot;VE&quot;</span>,   <span class="stringliteral">&quot;VG&quot;</span>,   <span class="stringliteral">&quot;VH&quot;</span>,   <span class="stringliteral">&quot;VI&quot;</span>,   <span class="stringliteral">&quot;VL&quot;</span>,   <span class="stringliteral">&quot;VM&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;VN&quot;</span>,   <span class="stringliteral">&quot;VO&quot;</span>,   <span class="stringliteral">&quot;VQ&quot;</span>,   <span class="stringliteral">&quot;VR&quot;</span>,   <span class="stringliteral">&quot;VT&quot;</span>,   <span class="stringliteral">&quot;VV&quot;</span>,   <span class="stringliteral">&quot;VY&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;WA&quot;</span>,   <span class="stringliteral">&quot;WB&quot;</span>,   <span class="stringliteral">&quot;WI&quot;</span>,   <span class="stringliteral">&quot;WM&quot;</span>,   <span class="stringliteral">&quot;WP&quot;</span>,   <span class="stringliteral">&quot;WQ&quot;</span>,   <span class="stringliteral">&quot;WR&quot;</span>,   <span class="stringliteral">&quot;WS&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;Y&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;ZK&quot;</span>,   <span class="stringliteral">&quot;ZM&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;Z&quot;</span>,</div>
<div class="line">    NULL</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *months[12] = {</div>
<div class="line">    <span class="stringliteral">&quot;JAN&quot;</span>, <span class="stringliteral">&quot;FEB&quot;</span>, <span class="stringliteral">&quot;MAR&quot;</span>, <span class="stringliteral">&quot;APR&quot;</span>, <span class="stringliteral">&quot;MAY&quot;</span>, <span class="stringliteral">&quot;JUN&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;JUL&quot;</span>, <span class="stringliteral">&quot;AUG&quot;</span>, <span class="stringliteral">&quot;SEP&quot;</span>, <span class="stringliteral">&quot;OCT&quot;</span>, <span class="stringliteral">&quot;NOV&quot;</span>, <span class="stringliteral">&quot;DEC&quot;</span></div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>{</div>
<div class="line">    <span class="keywordtype">int</span>     cycle;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>  *start;</div>
<div class="line">} airac_eff_dates[] = {</div>
<div class="line">    <span class="comment">/* year 2015 */</span></div>
<div class="line">    {1501, <span class="stringliteral">&quot;08-JAN&quot;</span>}, {1502, <span class="stringliteral">&quot;05-FEB&quot;</span>}, {1503, <span class="stringliteral">&quot;05-MAR&quot;</span>}, {1504, <span class="stringliteral">&quot;02-APR&quot;</span>},</div>
<div class="line">    {1505, <span class="stringliteral">&quot;30-APR&quot;</span>}, {1506, <span class="stringliteral">&quot;28-MAY&quot;</span>}, {1507, <span class="stringliteral">&quot;25-JUN&quot;</span>}, {1508, <span class="stringliteral">&quot;23-JUL&quot;</span>},</div>
<div class="line">    {1509, <span class="stringliteral">&quot;20-AUG&quot;</span>}, {1510, <span class="stringliteral">&quot;17-SEP&quot;</span>}, {1511, <span class="stringliteral">&quot;15-OCT&quot;</span>}, {1512, <span class="stringliteral">&quot;12-NOV&quot;</span>},</div>
<div class="line">    {1513, <span class="stringliteral">&quot;10-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2016 */</span></div>
<div class="line">    {1601, <span class="stringliteral">&quot;07-JAN&quot;</span>}, {1602, <span class="stringliteral">&quot;04-FEB&quot;</span>}, {1603, <span class="stringliteral">&quot;03-MAR&quot;</span>}, {1604, <span class="stringliteral">&quot;31-MAR&quot;</span>},</div>
<div class="line">    {1605, <span class="stringliteral">&quot;28-APR&quot;</span>}, {1606, <span class="stringliteral">&quot;26-MAY&quot;</span>}, {1607, <span class="stringliteral">&quot;23-JUN&quot;</span>}, {1608, <span class="stringliteral">&quot;21-JUL&quot;</span>},</div>
<div class="line">    {1609, <span class="stringliteral">&quot;18-AUG&quot;</span>}, {1610, <span class="stringliteral">&quot;15-SEP&quot;</span>}, {1611, <span class="stringliteral">&quot;13-OCT&quot;</span>}, {1612, <span class="stringliteral">&quot;10-NOV&quot;</span>},</div>
<div class="line">    {1613, <span class="stringliteral">&quot;08-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2017 */</span></div>
<div class="line">    {1701, <span class="stringliteral">&quot;05-JAN&quot;</span>}, {1702, <span class="stringliteral">&quot;02-FEB&quot;</span>}, {1703, <span class="stringliteral">&quot;02-MAR&quot;</span>}, {1704, <span class="stringliteral">&quot;30-MAR&quot;</span>},</div>
<div class="line">    {1705, <span class="stringliteral">&quot;27-APR&quot;</span>}, {1706, <span class="stringliteral">&quot;25-MAY&quot;</span>}, {1707, <span class="stringliteral">&quot;22-JUN&quot;</span>}, {1708, <span class="stringliteral">&quot;20-JUL&quot;</span>},</div>
<div class="line">    {1709, <span class="stringliteral">&quot;17-AUG&quot;</span>}, {1710, <span class="stringliteral">&quot;14-SEP&quot;</span>}, {1711, <span class="stringliteral">&quot;12-OCT&quot;</span>}, {1712, <span class="stringliteral">&quot;09-NOV&quot;</span>},</div>
<div class="line">    {1713, <span class="stringliteral">&quot;07-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2018 */</span></div>
<div class="line">    {1801, <span class="stringliteral">&quot;04-JAN&quot;</span>}, {1802, <span class="stringliteral">&quot;01-FEB&quot;</span>}, {1803, <span class="stringliteral">&quot;01-MAR&quot;</span>}, {1804, <span class="stringliteral">&quot;29-MAR&quot;</span>},</div>
<div class="line">    {1805, <span class="stringliteral">&quot;26-APR&quot;</span>}, {1806, <span class="stringliteral">&quot;24-MAY&quot;</span>}, {1807, <span class="stringliteral">&quot;21-JUN&quot;</span>}, {1808, <span class="stringliteral">&quot;19-JUL&quot;</span>},</div>
<div class="line">    {1809, <span class="stringliteral">&quot;16-AUG&quot;</span>}, {1810, <span class="stringliteral">&quot;13-SEP&quot;</span>}, {1811, <span class="stringliteral">&quot;11-OCT&quot;</span>}, {1812, <span class="stringliteral">&quot;08-NOV&quot;</span>},</div>
<div class="line">    {1813, <span class="stringliteral">&quot;06-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2019 */</span></div>
<div class="line">    {1901, <span class="stringliteral">&quot;03-JAN&quot;</span>}, {1902, <span class="stringliteral">&quot;31-JAN&quot;</span>}, {1903, <span class="stringliteral">&quot;28-FEB&quot;</span>}, {1904, <span class="stringliteral">&quot;28-MAR&quot;</span>},</div>
<div class="line">    {1905, <span class="stringliteral">&quot;25-APR&quot;</span>}, {1906, <span class="stringliteral">&quot;23-MAY&quot;</span>}, {1907, <span class="stringliteral">&quot;20-JUN&quot;</span>}, {1908, <span class="stringliteral">&quot;18-JUL&quot;</span>},</div>
<div class="line">    {1909, <span class="stringliteral">&quot;15-AUG&quot;</span>}, {1910, <span class="stringliteral">&quot;12-SEP&quot;</span>}, {1911, <span class="stringliteral">&quot;10-OCT&quot;</span>}, {1912, <span class="stringliteral">&quot;07-NOV&quot;</span>},</div>
<div class="line">    {1913, <span class="stringliteral">&quot;05-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2020 */</span></div>
<div class="line">    {2001, <span class="stringliteral">&quot;02-JAN&quot;</span>}, {2002, <span class="stringliteral">&quot;30-JAN&quot;</span>}, {2003, <span class="stringliteral">&quot;27-FEB&quot;</span>}, {2004, <span class="stringliteral">&quot;26-MAR&quot;</span>},</div>
<div class="line">    {2005, <span class="stringliteral">&quot;23-APR&quot;</span>}, {2006, <span class="stringliteral">&quot;21-MAY&quot;</span>}, {2007, <span class="stringliteral">&quot;18-JUN&quot;</span>}, {2008, <span class="stringliteral">&quot;16-JUL&quot;</span>},</div>
<div class="line">    {2009, <span class="stringliteral">&quot;13-AUG&quot;</span>}, {2010, <span class="stringliteral">&quot;10-SEP&quot;</span>}, {2011, <span class="stringliteral">&quot;08-OCT&quot;</span>}, {2012, <span class="stringliteral">&quot;05-NOV&quot;</span>},</div>
<div class="line">    {2013, <span class="stringliteral">&quot;03-DEC&quot;</span>}, {2014, <span class="stringliteral">&quot;31-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2021 */</span></div>
<div class="line">    {2101, <span class="stringliteral">&quot;28-JAN&quot;</span>}, {2102, <span class="stringliteral">&quot;25-FEB&quot;</span>}, {2103, <span class="stringliteral">&quot;25-MAR&quot;</span>}, {2104, <span class="stringliteral">&quot;22-APR&quot;</span>},</div>
<div class="line">    {2105, <span class="stringliteral">&quot;20-MAY&quot;</span>}, {2106, <span class="stringliteral">&quot;17-JUN&quot;</span>}, {2107, <span class="stringliteral">&quot;15-JUL&quot;</span>}, {2108, <span class="stringliteral">&quot;12-AUG&quot;</span>},</div>
<div class="line">    {2109, <span class="stringliteral">&quot;09-SEP&quot;</span>}, {2110, <span class="stringliteral">&quot;07-OCT&quot;</span>}, {2111, <span class="stringliteral">&quot;04-NOV&quot;</span>}, {2112, <span class="stringliteral">&quot;02-DEC&quot;</span>},</div>
<div class="line">    {2113, <span class="stringliteral">&quot;30-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2022 */</span></div>
<div class="line">    {2201, <span class="stringliteral">&quot;27-JAN&quot;</span>}, {2202, <span class="stringliteral">&quot;24-FEB&quot;</span>}, {2203, <span class="stringliteral">&quot;24-MAR&quot;</span>}, {2204, <span class="stringliteral">&quot;21-APR&quot;</span>},</div>
<div class="line">    {2205, <span class="stringliteral">&quot;19-MAY&quot;</span>}, {2206, <span class="stringliteral">&quot;16-JUN&quot;</span>}, {2207, <span class="stringliteral">&quot;14-JUL&quot;</span>}, {2208, <span class="stringliteral">&quot;11-AUG&quot;</span>},</div>
<div class="line">    {2209, <span class="stringliteral">&quot;08-SEP&quot;</span>}, {2210, <span class="stringliteral">&quot;06-OCT&quot;</span>}, {2211, <span class="stringliteral">&quot;03-NOV&quot;</span>}, {2212, <span class="stringliteral">&quot;01-DEC&quot;</span>},</div>
<div class="line">    {2213, <span class="stringliteral">&quot;29-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2023 */</span></div>
<div class="line">    {2301, <span class="stringliteral">&quot;26-JAN&quot;</span>}, {2302, <span class="stringliteral">&quot;23-FEB&quot;</span>}, {2303, <span class="stringliteral">&quot;23-MAR&quot;</span>}, {2304, <span class="stringliteral">&quot;20-APR&quot;</span>},</div>
<div class="line">    {2305, <span class="stringliteral">&quot;18-MAY&quot;</span>}, {2306, <span class="stringliteral">&quot;15-JUN&quot;</span>}, {2307, <span class="stringliteral">&quot;13-JUL&quot;</span>}, {2308, <span class="stringliteral">&quot;10-AUG&quot;</span>},</div>
<div class="line">    {2309, <span class="stringliteral">&quot;07-SEP&quot;</span>}, {2310, <span class="stringliteral">&quot;05-OCT&quot;</span>}, {2311, <span class="stringliteral">&quot;02-NOV&quot;</span>}, {2312, <span class="stringliteral">&quot;30-NOV&quot;</span>},</div>
<div class="line">    {2313, <span class="stringliteral">&quot;28-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2024 */</span></div>
<div class="line">    {2401, <span class="stringliteral">&quot;25-JAN&quot;</span>}, {2402, <span class="stringliteral">&quot;22-FEB&quot;</span>}, {2403, <span class="stringliteral">&quot;21-MAR&quot;</span>}, {2404, <span class="stringliteral">&quot;18-APR&quot;</span>},</div>
<div class="line">    {2405, <span class="stringliteral">&quot;16-MAY&quot;</span>}, {2406, <span class="stringliteral">&quot;13-JUN&quot;</span>}, {2407, <span class="stringliteral">&quot;11-JUL&quot;</span>}, {2408, <span class="stringliteral">&quot;08-AUG&quot;</span>},</div>
<div class="line">    {2409, <span class="stringliteral">&quot;05-SEP&quot;</span>}, {2410, <span class="stringliteral">&quot;03-OCT&quot;</span>}, {2411, <span class="stringliteral">&quot;31-OCT&quot;</span>}, {2412, <span class="stringliteral">&quot;28-NOV&quot;</span>},</div>
<div class="line">    {2413, <span class="stringliteral">&quot;26-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2025 */</span></div>
<div class="line">    {2501, <span class="stringliteral">&quot;23-JAN&quot;</span>}, {2502, <span class="stringliteral">&quot;20-FEB&quot;</span>}, {2503, <span class="stringliteral">&quot;20-MAR&quot;</span>}, {2504, <span class="stringliteral">&quot;17-APR&quot;</span>},</div>
<div class="line">    {2505, <span class="stringliteral">&quot;15-MAY&quot;</span>}, {2506, <span class="stringliteral">&quot;12-JUN&quot;</span>}, {2507, <span class="stringliteral">&quot;10-JUL&quot;</span>}, {2508, <span class="stringliteral">&quot;07-AUG&quot;</span>},</div>
<div class="line">    {2509, <span class="stringliteral">&quot;04-SEP&quot;</span>}, {2510, <span class="stringliteral">&quot;02-OCT&quot;</span>}, {2511, <span class="stringliteral">&quot;30-OCT&quot;</span>}, {2512, <span class="stringliteral">&quot;27-NOV&quot;</span>},</div>
<div class="line">    {2513, <span class="stringliteral">&quot;25-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2026 */</span></div>
<div class="line">    {2601, <span class="stringliteral">&quot;22-JAN&quot;</span>}, {2602, <span class="stringliteral">&quot;19-FEB&quot;</span>}, {2603, <span class="stringliteral">&quot;19-MAR&quot;</span>}, {2604, <span class="stringliteral">&quot;16-APR&quot;</span>},</div>
<div class="line">    {2605, <span class="stringliteral">&quot;14-MAY&quot;</span>}, {2606, <span class="stringliteral">&quot;11-JUN&quot;</span>}, {2607, <span class="stringliteral">&quot;09-JUL&quot;</span>}, {2608, <span class="stringliteral">&quot;06-AUG&quot;</span>},</div>
<div class="line">    {2609, <span class="stringliteral">&quot;03-SEP&quot;</span>}, {2610, <span class="stringliteral">&quot;01-OCT&quot;</span>}, {2611, <span class="stringliteral">&quot;29-OCT&quot;</span>}, {2612, <span class="stringliteral">&quot;26-NOV&quot;</span>},</div>
<div class="line">    {2613, <span class="stringliteral">&quot;24-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2027 */</span></div>
<div class="line">    {2701, <span class="stringliteral">&quot;21-JAN&quot;</span>}, {2702, <span class="stringliteral">&quot;18-FEB&quot;</span>}, {2703, <span class="stringliteral">&quot;18-MAR&quot;</span>}, {2704, <span class="stringliteral">&quot;15-APR&quot;</span>},</div>
<div class="line">    {2705, <span class="stringliteral">&quot;13-MAY&quot;</span>}, {2706, <span class="stringliteral">&quot;10-JUN&quot;</span>}, {2707, <span class="stringliteral">&quot;08-JUL&quot;</span>}, {2708, <span class="stringliteral">&quot;05-AUG&quot;</span>},</div>
<div class="line">    {2709, <span class="stringliteral">&quot;02-SEP&quot;</span>}, {2710, <span class="stringliteral">&quot;30-SEP&quot;</span>}, {2711, <span class="stringliteral">&quot;28-OCT&quot;</span>}, {2712, <span class="stringliteral">&quot;25-NOV&quot;</span>},</div>
<div class="line">    {2713, <span class="stringliteral">&quot;23-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2028 */</span></div>
<div class="line">    {2801, <span class="stringliteral">&quot;20-JAN&quot;</span>}, {2802, <span class="stringliteral">&quot;17-FEB&quot;</span>}, {2803, <span class="stringliteral">&quot;16-MAR&quot;</span>}, {2804, <span class="stringliteral">&quot;13-APR&quot;</span>},</div>
<div class="line">    {2805, <span class="stringliteral">&quot;11-MAY&quot;</span>}, {2806, <span class="stringliteral">&quot;08-JUN&quot;</span>}, {2807, <span class="stringliteral">&quot;06-JUL&quot;</span>}, {2808, <span class="stringliteral">&quot;03-AUG&quot;</span>},</div>
<div class="line">    {2809, <span class="stringliteral">&quot;31-AUG&quot;</span>}, {2810, <span class="stringliteral">&quot;28-SEP&quot;</span>}, {2811, <span class="stringliteral">&quot;26-OCT&quot;</span>}, {2812, <span class="stringliteral">&quot;23-NOV&quot;</span>},</div>
<div class="line">    {2813, <span class="stringliteral">&quot;21-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* year 2029 */</span></div>
<div class="line">    {2901, <span class="stringliteral">&quot;18-JAN&quot;</span>}, {2902, <span class="stringliteral">&quot;15-FEB&quot;</span>}, {2903, <span class="stringliteral">&quot;15-MAR&quot;</span>}, {2904, <span class="stringliteral">&quot;12-APR&quot;</span>},</div>
<div class="line">    {2905, <span class="stringliteral">&quot;10-MAY&quot;</span>}, {2906, <span class="stringliteral">&quot;07-JUN&quot;</span>}, {2907, <span class="stringliteral">&quot;05-JUL&quot;</span>}, {2908, <span class="stringliteral">&quot;02-AUG&quot;</span>},</div>
<div class="line">    {2909, <span class="stringliteral">&quot;30-AUG&quot;</span>}, {2910, <span class="stringliteral">&quot;27-SEP&quot;</span>}, {2911, <span class="stringliteral">&quot;25-OCT&quot;</span>}, {2912, <span class="stringliteral">&quot;22-NOV&quot;</span>},</div>
<div class="line">    {2912, <span class="stringliteral">&quot;20-DEC&quot;</span>},</div>
<div class="line">    <span class="comment">/* end of list */</span></div>
<div class="line">    { .cycle = -1 }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * How to turn to get from hdg1 to hdg2 with positive being right and negative</span></div>
<div class="line"><span class="comment"> * being left. Always turns the shortest way around (&lt;= 180 degrees).</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">double</span></div>
<div class="line"><a name="a0"></a><a class="code" href="helpers_8h.html#aab2e0b814c99c025f8f9f104fbc2524b">rel_hdg_impl</a>(<span class="keywordtype">double</span> hdg1, <span class="keywordtype">double</span> hdg2, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">int</span> line)</div>
<div class="line">{</div>
<div class="line">    <a name="a1"></a><a class="code" href="assert_8h.html#a26960017b3b93ae2f2025c5a4bb06493">ASSERT_MSG</a>(<a name="a2"></a><a class="code" href="helpers_8h.html#a7c9d440c0119c02b39eaf28f902118e9">is_valid_hdg</a>(hdg1) &amp;&amp; <a class="code" href="helpers_8h.html#a7c9d440c0119c02b39eaf28f902118e9">is_valid_hdg</a>(hdg2),</div>
<div class="line">        <span class="stringliteral">&quot;from: %s:%d %f -&gt; %f&quot;</span>, file, line, hdg1, hdg2);</div>
<div class="line">    <span class="keywordflow">if</span> (hdg1 &gt; hdg2) {</div>
<div class="line">        <span class="keywordflow">if</span> (hdg1 &gt; hdg2 + 180)</div>
<div class="line">            <span class="keywordflow">return</span> (360 - hdg1 + hdg2);</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> (-(hdg1 - hdg2));</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="keywordflow">if</span> (hdg2 &gt; hdg1 + 180)</div>
<div class="line">            <span class="keywordflow">return</span> (-(360 - hdg2 + hdg1));</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">            <span class="keywordflow">return</span> (hdg2 - hdg1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT bool_t</div>
<div class="line"><a name="a3"></a><a class="code" href="helpers_8h.html#ac42646e74896317edfba4743494c72d2">is_valid_xpdr_code</a>(<span class="keywordtype">int</span> code)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> (code &gt;= 0 &amp;&amp; code &lt;= 7777 &amp;&amp;</div>
<div class="line">        (code % 10) &lt;= 7 &amp;&amp;</div>
<div class="line">        ((code / 10) % 10) &lt;= 7 &amp;&amp;</div>
<div class="line">        ((code / 100) % 10) &lt;= 7 &amp;&amp;</div>
<div class="line">        ((code / 1000) % 10) &lt;= 7);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a4"></a><a class="code" href="helpers_8h.html#a7506407dd76baea064f50cb0caa9e7f6">is_valid_vor_freq</a>(<span class="keywordtype">double</span> freq_mhz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> freq_khz = freq_mhz * 1000;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check correct frequency band */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz &lt; 108000 || freq_khz &gt; 117950)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Check the LOC band - freq must be multiple of 200 kHz or</span></div>
<div class="line"><span class="comment">     * remainder must be 50 kHz.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz &gt;= 108000 &amp;&amp; freq_khz &lt;= 112000 &amp;&amp;</div>
<div class="line">        freq_khz % 200 != 0 &amp;&amp; freq_khz % 200 != 50)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="comment">/* Above 112 MHz, frequency must be multiple of 50 kHz */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz % 50 != 0)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a5"></a><a class="code" href="helpers_8h.html#a649de234cc792d4f96364245729ec4b1">is_valid_loc_freq</a>(<span class="keywordtype">double</span> freq_mhz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> freq_khz = freq_mhz * 1000;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* Check correct frequency band */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz &lt; 108100 || freq_khz &gt; 111950)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="comment">/* Check 200 kHz spacing with 100 kHz or 150 kHz remainder. */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz % 200 != 100 &amp;&amp; freq_khz % 200 != 150)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a6"></a><a class="code" href="helpers_8h.html#a8f87ba6dc040d945474f832594982717">is_valid_tacan_freq</a>(<span class="keywordtype">double</span> freq_mhz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> freq_khz = freq_mhz * 1000;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* this is quite a guess! */</span></div>
<div class="line">    <span class="keywordflow">if</span> (freq_khz &lt; 133000 || freq_khz &gt; 136000 ||</div>
<div class="line">        freq_khz % 100 != 0)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a7"></a><a class="code" href="helpers_8h.html#a77793777dd754d167695308feae78833">is_valid_ndb_freq</a>(<span class="keywordtype">double</span> freq_khz)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">unsigned</span> freq_hz = freq_khz * 1000;</div>
<div class="line">    <span class="comment">/* 177 kHz for an NDB is the lowest I&#39;ve ever seen */</span></div>
<div class="line">    <span class="keywordflow">return</span> (freq_hz &gt;= 177000 &amp;&amp; freq_hz &lt;= 1750000);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a8"></a><a class="code" href="helpers_8h.html#a3c1a2e6f05dd84ac0b31464d12eeb4b5">is_valid_icao_code</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *icao)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strlen(icao) != 4)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 4; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> ((icao[i] &lt; <span class="charliteral">&#39;A&#39;</span> || icao[i] &gt; <span class="charliteral">&#39;Z&#39;</span>) &amp;&amp;</div>
<div class="line">            (icao[i] &lt; <span class="charliteral">&#39;0&#39;</span> || icao[i] &gt; <span class="charliteral">&#39;9&#39;</span>)) {</div>
<div class="line">            <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (icao[0] == <span class="charliteral">&#39;I&#39;</span> || icao[0] == <span class="charliteral">&#39;J&#39;</span> || icao[0] == <span class="charliteral">&#39;Q&#39;</span> ||</div>
<div class="line">        icao[0] == <span class="charliteral">&#39;X&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a9"></a><a class="code" href="helpers_8h.html#aef0696611004600a10d0ff68f92f235b">is_valid_iata_code</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *iata)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (strlen(iata) != 3)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 3; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (iata[i] &lt; <span class="charliteral">&#39;A&#39;</span> || iata[i] &gt; <span class="charliteral">&#39;Z&#39;</span>)</div>
<div class="line">            <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (iata[0] == <span class="charliteral">&#39;Q&#39;</span>)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="a10"></a><a class="code" href="helpers_8h.html#a88cfba22243cc7fac93e890adfd16adb">extract_icao_country_code</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *icao)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (!<a class="code" href="helpers_8h.html#a3c1a2e6f05dd84ac0b31464d12eeb4b5">is_valid_icao_code</a>(icao))</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; icao_country_codes[i] != NULL; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (strncmp(icao, icao_country_codes[i],</div>
<div class="line">            strlen(icao_country_codes[i])) == 0)</div>
<div class="line">            <span class="keywordflow">return</span> (icao_country_codes[i]);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a11"></a><a class="code" href="helpers_8h.html#ab16fce6a4a8867f5fb5415c6c291f2b7">is_valid_rwy_ID</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *rwy_ID)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> hdg;</div>
<div class="line">    <span class="keywordtype">int</span> len = strlen(rwy_ID);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (len &lt; 2 || len &gt; 3 || !isdigit(rwy_ID[0]) || !isdigit(rwy_ID[1]))</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    hdg = atoi(rwy_ID);</div>
<div class="line">    <span class="keywordflow">if</span> (hdg == 0 || hdg &gt; 36)</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    <span class="keywordflow">if</span> (len == 3) {</div>
<div class="line">        <span class="keywordflow">if</span> (rwy_ID[2] != <span class="charliteral">&#39;R&#39;</span> &amp;&amp; rwy_ID[2] != <span class="charliteral">&#39;L&#39;</span> &amp;&amp; rwy_ID[2] != <span class="charliteral">&#39;C&#39;</span> &amp;&amp;</div>
<div class="line">            rwy_ID[2] != <span class="charliteral">&#39;T&#39;</span>) {</div>
<div class="line">            <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line"><a name="a12"></a><a class="code" href="helpers_8h.html#a361e1a0df927839f8a04c9df79bbc15b">copy_rwy_ID</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *src, <span class="keywordtype">char</span> dst[4])</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> len;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* make sure dst is populated with *something* */</span></div>
<div class="line">    memset(dst, 0, 4);</div>
<div class="line">    lacf_strlcpy(dst, src, 4);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Strip an optional trailing true hdg indicator. If the runway had</span></div>
<div class="line"><span class="comment">     * a suffix (e.g. &#39;08LT&#39;), the previous copy step will have already</span></div>
<div class="line"><span class="comment">     * stripped it.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    len = strlen(dst);</div>
<div class="line">    <span class="keywordflow">if</span> (len &gt; 0 &amp;&amp; dst[len - 1] == <span class="charliteral">&#39;T&#39;</span>) {</div>
<div class="line">        dst[len - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">        len--;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* check if the identifier is a US runway number and translate it */</span></div>
<div class="line">    <span class="keywordflow">if</span> (dst[0] &gt;= <span class="charliteral">&#39;1&#39;</span> &amp;&amp; dst[0] &lt;= <span class="charliteral">&#39;9&#39;</span> &amp;&amp;</div>
<div class="line">        (len == 1 || (len == 2 &amp;&amp; !isdigit(dst[1])))) {</div>
<div class="line">        memmove(dst + 1, dst, len + 1);</div>
<div class="line">        dst[0] = <span class="charliteral">&#39;0&#39;</span>;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">month2nr(<span class="keyword">const</span> <span class="keywordtype">char</span> *month)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 12; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(month, months[i]) == 0)</div>
<div class="line">            <span class="keywordflow">return</span> (i);</div>
<div class="line">    }</div>
<div class="line">    <a name="a13"></a><a class="code" href="assert_8h.html#ad157a1a262c174b8a8744896359009b7">VERIFY_MSG</a>(0, <span class="stringliteral">&quot;Invalid month specified: \&quot;%s\&quot;&quot;</span>, month);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line">nr2month(<span class="keywordtype">unsigned</span> tm_mon)</div>
<div class="line">{</div>
<div class="line">    <a name="a14"></a><a class="code" href="assert_8h.html#ad1382f354d22108a9b483f437eac5536">VERIFY3S</a>(tm_mon, &lt;, 12);</div>
<div class="line">    <span class="keywordflow">return</span> (months[tm_mon]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> time_t</div>
<div class="line">cycle2start(<span class="keywordtype">int</span> i)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">struct </span>tm cyc_tm = { .tm_year = 0 };</div>
<div class="line">    <span class="keywordtype">char</span> day[4], month[4];</div>
<div class="line">    <span class="keywordtype">int</span> year = (airac_eff_dates[i].cycle / 100) + 100;</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *start = airac_eff_dates[i].start;</div>
<div class="line"> </div>
<div class="line">    snprintf(day, <span class="keyword">sizeof</span> (day), <span class="stringliteral">&quot;%c%c&quot;</span>, start[0], start[1]);</div>
<div class="line">    snprintf(month, <span class="keyword">sizeof</span> (month), <span class="stringliteral">&quot;%c%c%c&quot;</span>, start[3], start[4], start[5]);</div>
<div class="line"> </div>
<div class="line">    cyc_tm.tm_year = year;</div>
<div class="line">    cyc_tm.tm_mday = atoi(day);</div>
<div class="line">    cyc_tm.tm_mon = month2nr(month);</div>
<div class="line">    cyc_tm.tm_wday = -1;</div>
<div class="line">    cyc_tm.tm_yday = -1;</div>
<div class="line">    cyc_tm.tm_isdst = -1;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (lacf_timegm(&amp;cyc_tm));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *</div>
<div class="line"><a name="a15"></a><a class="code" href="helpers_8h.html#a4a2d6a9dd5dfa4e0cd9698020c81fc1f">airac_cycle2eff_date</a>(<span class="keywordtype">int</span> cycle)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; airac_eff_dates[i].cycle != -1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (airac_eff_dates[i].cycle == cycle)</div>
<div class="line">            <span class="keywordflow">return</span> (airac_eff_dates[i].start);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">time_t</div>
<div class="line"><a name="a16"></a><a class="code" href="helpers_8h.html#ac1d25f92a294583c6464dead6d76d486">airac_cycle2eff_date2</a>(<span class="keywordtype">int</span> cycle) {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; airac_eff_dates[i].cycle != -1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (airac_eff_dates[i].cycle == cycle)</div>
<div class="line">            <span class="keywordflow">return</span> (cycle2start(i));</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (-1u);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line"><a name="a17"></a><a class="code" href="helpers_8h.html#a99a82d2bf808f14f113bb5fd787d780a">airac_cycle2exp_date</a>(<span class="keywordtype">int</span> cycle, <span class="keywordtype">char</span> buf[16], time_t *cycle_end_p)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; airac_eff_dates[i].cycle != -1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (airac_eff_dates[i].cycle == cycle) {</div>
<div class="line">            <span class="comment">/*</span></div>
<div class="line"><span class="comment">             * Grab the effective date of the next cycle and</span></div>
<div class="line"><span class="comment">             * subtract one day second. The end time will be</span></div>
<div class="line"><span class="comment">             * the previous day at 23:59:59.</span></div>
<div class="line"><span class="comment">             */</span></div>
<div class="line">            time_t cycle_end_t = cycle2start(i) + 28 * 86400;</div>
<div class="line">            <span class="keyword">struct </span>tm end_tm;</div>
<div class="line"> </div>
<div class="line">            lacf_gmtime_r(&amp;cycle_end_t, &amp;end_tm);</div>
<div class="line">            <span class="keywordflow">if</span> (buf != NULL) {</div>
<div class="line">                snprintf(buf, 16, <span class="stringliteral">&quot;%02d-%s&quot;</span>, end_tm.tm_mday,</div>
<div class="line">                    nr2month(end_tm.tm_mon));</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">if</span> (cycle_end_p != NULL)</div>
<div class="line">                *cycle_end_p = cycle_end_t;</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line"><a name="a18"></a><a class="code" href="helpers_8h.html#a126c9985207224b1487aa70bf8372e49">airac_time2cycle</a>(time_t t)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; airac_eff_dates[i].cycle != -1; i++) {</div>
<div class="line">        <span class="keywordflow">if</span> (cycle2start(i) &gt; t &amp;&amp; i &gt; 0)</div>
<div class="line">            <span class="keywordflow">return</span> (airac_eff_dates[i - 1].cycle);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (-1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ssize_t</div>
<div class="line"><a name="a19"></a><a class="code" href="helpers_8h.html#a3cb4d21bba429e71025889e0aea7b1d6">explode_line</a>(<span class="keywordtype">char</span> *line, <span class="keywordtype">char</span> delim, <span class="keywordtype">char</span> **comps, <span class="keywordtype">size_t</span> capacity)</div>
<div class="line">{</div>
<div class="line">    ssize_t i = 1;</div>
<div class="line">    bool_t  toomany = B_FALSE;</div>
<div class="line"> </div>
<div class="line">    <a name="a20"></a><a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(capacity != 0);</div>
<div class="line">    comps[0] = line;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">char</span> *p = line; *p != 0; p++) {</div>
<div class="line">        <span class="keywordflow">if</span> (*p == delim) {</div>
<div class="line">            *p = 0;</div>
<div class="line">            <span class="keywordflow">if</span> (i &lt; (ssize_t)capacity)</div>
<div class="line">                comps[i] = p + 1;</div>
<div class="line">            <span class="keywordflow">else</span></div>
<div class="line">                toomany = B_TRUE;</div>
<div class="line">            i++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (toomany ? -i : i);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> **</div>
<div class="line">strsplit(<span class="keyword">const</span> <span class="keywordtype">char</span> *input, <span class="keyword">const</span> <span class="keywordtype">char</span> *sep, bool_t skip_empty, <span class="keywordtype">size_t</span> *num)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> **result;</div>
<div class="line">    <span class="keywordtype">size_t</span> i = 0, n = 0;</div>
<div class="line">    <span class="keywordtype">size_t</span> seplen = strlen(sep);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *a = input, *b = strstr(a, sep);</div>
<div class="line">        a != NULL; a = b + seplen, b = strstr(a, sep)) {</div>
<div class="line">        <span class="keywordflow">if</span> (b == NULL) {</div>
<div class="line">            b = input + strlen(input);</div>
<div class="line">            <span class="keywordflow">if</span> (a != b || !skip_empty)</div>
<div class="line">                n++;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (a == b &amp;&amp; skip_empty)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        n++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    result = <a name="a21"></a><a class="code" href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a>(n, <span class="keyword">sizeof</span> (<span class="keywordtype">char</span> *));</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *a = input, *b = strstr(a, sep);</div>
<div class="line">        a != NULL; a = b + seplen, b = strstr(a, sep)) {</div>
<div class="line">        <span class="keywordflow">if</span> (b == NULL) {</div>
<div class="line">            b = input + strlen(input);</div>
<div class="line">            <span class="keywordflow">if</span> (a != b || !skip_empty) {</div>
<div class="line">                result[i] = <a class="code" href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a>(b - a + 1,</div>
<div class="line">                    <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));</div>
<div class="line">                memcpy(result[i], a, b - a);</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (a == b &amp;&amp; skip_empty)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(i &lt; n);</div>
<div class="line">        result[i] = <a class="code" href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a>(b - a + 1, <span class="keyword">sizeof</span> (<span class="keywordtype">char</span>));</div>
<div class="line">        memcpy(result[i], a, b - a);</div>
<div class="line">        i++;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (num != NULL)</div>
<div class="line">        *num = n;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Frees a string array returned by strsplit.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">free_strlist(<span class="keywordtype">char</span> **comps, <span class="keywordtype">size_t</span> len)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (comps == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; len; i++)</div>
<div class="line">        free(comps[i]);</div>
<div class="line">    free(comps);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Appends a printf-like formatted string to the end of *str, reallocating</span></div>
<div class="line"><span class="comment"> * the buffer as needed to contain it. The value of *str is modified to</span></div>
<div class="line"><span class="comment"> * point to the appropriately reallocated buffer.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">append_format(<span class="keywordtype">char</span> **str, <span class="keywordtype">size_t</span> *sz, <span class="keyword">const</span> <span class="keywordtype">char</span> *format, ...)</div>
<div class="line">{</div>
<div class="line">    va_list ap;</div>
<div class="line">    <span class="keywordtype">int</span> needed;</div>
<div class="line"> </div>
<div class="line">    va_start(ap, format);</div>
<div class="line">    needed = vsnprintf(NULL, 0, format, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line"> </div>
<div class="line">    va_start(ap, format);</div>
<div class="line">    *str = <a name="a22"></a><a class="code" href="safe__alloc_8h.html#a9f32a56587b5252c01a2304b3e44d658">safe_realloc</a>(*str, *sz + needed + 1);</div>
<div class="line">    (void) vsnprintf(*str + *sz, *sz + needed + 1, format, ap);</div>
<div class="line">    *sz += needed;</div>
<div class="line">    va_end(ap);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Unescapes a string that uses &#39;%XX&#39; escape sequences, where &#39;XX&#39; are two</span></div>
<div class="line"><span class="comment"> * hex digits denoting the ASCII code of the character to be inserted in</span></div>
<div class="line"><span class="comment"> * place of the escape sequence. The argument &#39;str&#39; is shortened appropriately.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">unescape_percent(<span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, n = strlen(str); i + 2 &lt; n; i++) {</div>
<div class="line">        <span class="comment">/* Skip non-parseable hex digits */</span></div>
<div class="line">        <span class="keywordflow">if</span> (str[i] == <span class="charliteral">&#39;%&#39;</span> &amp;&amp; isxdigit(str[i + 1]) &amp;&amp;</div>
<div class="line">            isxdigit(str[i + 2])) {</div>
<div class="line">            <span class="keywordtype">char</span> dig[3] = { str[i + 1], str[i + 2], 0 };</div>
<div class="line">            <span class="keywordtype">unsigned</span> val;</div>
<div class="line">            sscanf(dig, <span class="stringliteral">&quot;%x&quot;</span>, &amp;val);</div>
<div class="line">            str[i] = val;</div>
<div class="line">            memmove(&amp;str[i + 1], &amp;str[i + 3], (n - i) - 2);</div>
<div class="line">            n -= 2;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">void</span></div>
<div class="line">strtolower(<span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, n = strlen(str); i &lt; n; i++)</div>
<div class="line">        str[i] = tolower(str[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">void</span></div>
<div class="line">strtoupper(<span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, n = strlen(str); i &lt; n; i++)</div>
<div class="line">        str[i] = toupper(str[i]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">size_t</span></div>
<div class="line">utf8_charlen(<span class="keyword">const</span> <span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> ((str[0] &amp; 0xe0) == 0xc0 &amp;&amp; str[1] != 0)</div>
<div class="line">        <span class="keywordflow">return</span> (2);</div>
<div class="line">    <span class="keywordflow">if</span> ((str[0] &amp; 0xf0) == 0xe0 &amp;&amp; str[1] != 0 &amp;&amp; str[2] != 0)</div>
<div class="line">        <span class="keywordflow">return</span> (3);</div>
<div class="line">    <span class="keywordflow">if</span> ((str[0] &amp; 0xf8) == 0xf0 &amp;&amp; str[1] != 0 &amp;&amp; str[2] != 0 &amp;&amp;</div>
<div class="line">        str[3] != 0)</div>
<div class="line">        <span class="keywordflow">return</span> (4);</div>
<div class="line">    <span class="keywordflow">return</span> (1);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">size_t</span></div>
<div class="line">utf8_strlen(<span class="keyword">const</span> <span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *s;</div>
<div class="line">    <span class="keywordflow">for</span> (s = str; s[0] != 0;)</div>
<div class="line">        s += utf8_charlen(str);</div>
<div class="line">    <span class="keywordflow">return</span> (s - str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Creates a file path string from individual path components. The</span></div>
<div class="line"><span class="comment"> * components are provided as separate filename arguments and the list needs</span></div>
<div class="line"><span class="comment"> * to be terminated with a NULL argument. The returned string can be freed</span></div>
<div class="line"><span class="comment"> * via free().</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">mkpathname(<span class="keyword">const</span> <span class="keywordtype">char</span> *comp, ...)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *res;</div>
<div class="line">    va_list ap;</div>
<div class="line"> </div>
<div class="line">    va_start(ap, comp);</div>
<div class="line">    res = mkpathname_v(comp, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (res);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">mkpathname_v(<span class="keyword">const</span> <span class="keywordtype">char</span> *comp, va_list ap)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> n = 0, len = 0;</div>
<div class="line">    <span class="keywordtype">char</span> *str;</div>
<div class="line">    va_list ap2;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ap != NULL);</div>
<div class="line"> </div>
<div class="line">    va_copy(ap2, ap);</div>
<div class="line">    len = strlen(comp);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *c = va_arg(ap2, <span class="keyword">const</span> <span class="keywordtype">char</span> *); c != NULL;</div>
<div class="line">        c = va_arg(ap2, <span class="keyword">const</span> <span class="keywordtype">char</span> *)) {</div>
<div class="line">        len += 1 + strlen(c);</div>
<div class="line">    }</div>
<div class="line">    va_end(ap2);</div>
<div class="line"> </div>
<div class="line">    str = <a name="a23"></a><a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(len + 1);</div>
<div class="line">    n += snprintf(str, len + 1, <span class="stringliteral">&quot;%s&quot;</span>, comp);</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *c = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *); c != NULL;</div>
<div class="line">        c = va_arg(ap, <span class="keyword">const</span> <span class="keywordtype">char</span> *)) {</div>
<div class="line">        <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(n &lt; len);</div>
<div class="line">        n += snprintf(&amp;str[n], len - n + 1, <span class="stringliteral">&quot;%c%s&quot;</span>, DIRSEP, c);</div>
<div class="line">        <span class="comment">/* kill a trailing directory separator */</span></div>
<div class="line">        <span class="keywordflow">if</span> (str[n - 1] == DIRSEP) {</div>
<div class="line">            str[n - 1] = 0;</div>
<div class="line">            n--;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * For some inexplicable reason, on Windows X-Plane can return paths via the</span></div>
<div class="line"><span class="comment"> * API which are a mixture of Windows- &amp; Unix-style path separators. This</span></div>
<div class="line"><span class="comment"> * function fixes that by flipping all path separators to the appropriate</span></div>
<div class="line"><span class="comment"> * type used on the host OS.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">fix_pathsep(<span class="keywordtype">char</span> *str)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0, n = strlen(str); i &lt; n; i++) {</div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line">        <span class="keywordflow">if</span> (str[i] == <span class="charliteral">&#39;/&#39;</span>)</div>
<div class="line">            str[i] = <span class="charliteral">&#39;\\&#39;</span>;</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span> (str[i] == <span class="charliteral">&#39;\\&#39;</span>)</div>
<div class="line">            str[i] = <span class="charliteral">&#39;/&#39;</span>;</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Strips the last path component from `path&#39; and replaces with with `replace&#39;.</span></div>
<div class="line"><span class="comment"> * Example:</span></div>
<div class="line"><span class="comment"> *  path = &quot;/foo/bar&quot;</span></div>
<div class="line"><span class="comment"> *  replace = &quot;baz&quot;</span></div>
<div class="line"><span class="comment"> *  result = &quot;/foo/baz&quot;</span></div>
<div class="line"><span class="comment"> * The returned value must be freed using lacf_free.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">path_last_comp_subst(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *replace)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *last_sep;</div>
<div class="line">    <span class="keywordtype">char</span> *tmp, *result;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(path != NULL);</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(replace != NULL);</div>
<div class="line"> </div>
<div class="line">    last_sep = MAX(strrchr(path, <span class="charliteral">&#39;/&#39;</span>), strrchr(path, <span class="charliteral">&#39;\\&#39;</span>));</div>
<div class="line">    <span class="keywordflow">if</span> (last_sep == NULL) {</div>
<div class="line">        <span class="comment">/* No path separator? Just return a copy of the replacement. */</span></div>
<div class="line">        <span class="keywordflow">return</span> (strdup(replace));</div>
<div class="line">    }</div>
<div class="line">    tmp = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(last_sep - path + 1);</div>
<div class="line">    lacf_strlcpy(tmp, path, last_sep - path + 1);</div>
<div class="line">    result = mkpathname(tmp, replace, NULL);</div>
<div class="line">    free(tmp);</div>
<div class="line">    path_normalize(result);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (result);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Returns the last path component of the path. If the path contains no</span></div>
<div class="line"><span class="comment"> * separators, returns the entire input path.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">path_last_comp(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *last;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(path != NULL);</div>
<div class="line">    last = MAX(strrchr(path, <span class="charliteral">&#39;/&#39;</span>), strrchr(path, <span class="charliteral">&#39;\\&#39;</span>));</div>
<div class="line">    <span class="keywordflow">if</span> (last != NULL)</div>
<div class="line">        last++;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        last = (<span class="keywordtype">char</span> *)path;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (last);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Takes `path&#39; and substitutes its path extension (any characters following</span></div>
<div class="line"><span class="comment"> * the last &#39;.&#39;) with `ext&#39;. If the path doesn&#39;t contain a path extension,</span></div>
<div class="line"><span class="comment"> * it is appended. The newly allocated path is returned to the caller.</span></div>
<div class="line"><span class="comment"> * The caller is responsible for freeing this path using lacf_free.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">path_ext_subst(<span class="keyword">const</span> <span class="keywordtype">char</span> *path, <span class="keyword">const</span> <span class="keywordtype">char</span> *ext)</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span> *period;</div>
<div class="line">    <span class="keywordtype">char</span> *str;</div>
<div class="line">    <span class="keywordtype">int</span> l, k;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(path != NULL);</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(ext != NULL);</div>
<div class="line">    period = strrchr(path, <span class="charliteral">&#39;.&#39;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (period == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (sprintf_alloc(<span class="stringliteral">&quot;%s.%s&quot;</span>, path, ext));</div>
<div class="line">    l = period - path;</div>
<div class="line">    k = strlen(ext);</div>
<div class="line">    str = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(l + strlen(ext) + 2);</div>
<div class="line">    strlcpy(str, path, l + 1);</div>
<div class="line">    strlcpy(&amp;str[l], <span class="stringliteral">&quot;.&quot;</span>, 2);</div>
<div class="line">    strlcpy(&amp;str[l + 1], ext, k + 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *</div>
<div class="line">find_prev_path_sep(<span class="keywordtype">char</span> *path, <span class="keywordtype">char</span> *elem)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(path != NULL);</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(elem != NULL);</div>
<div class="line">    <span class="keywordflow">for</span> (elem--; elem &gt;= path; elem--) {</div>
<div class="line">        <span class="keywordflow">if</span> (*elem == DIRSEP)</div>
<div class="line">            <span class="keywordflow">return</span> (elem);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (NULL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Locates all instances of &#39;//&#39;, &#39;\\&#39;, &#39;..&#39; and &#39;.&#39; and eliminates them from</span></div>
<div class="line"><span class="comment"> * the path, resolving directory returns as necessary. This also first flips</span></div>
<div class="line"><span class="comment"> * all path separators to the platform-appropriate type using fix_pathsep.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">path_normalize(<span class="keywordtype">char</span> *path)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *elem;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(path != NULL);</div>
<div class="line"> </div>
<div class="line">    fix_pathsep(path);</div>
<div class="line">    <span class="comment">/* Eliminate duplicate &#39;//&#39; and &#39;\\&#39; */</span></div>
<div class="line">    <span class="keywordflow">for</span> (elem = path; *elem != <span class="charliteral">&#39;\0&#39;</span>;) {</div>
<div class="line">        <span class="keywordflow">if</span> (elem[0] == DIRSEP &amp;&amp; elem[1] == DIRSEP) {</div>
<div class="line">            <span class="comment">/* Move the rest up one, to delete the duplicate */</span></div>
<div class="line">            memmove(elem, &amp;elem[1], strlen(&amp;elem[1]) + 1);</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            elem++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="comment">/* Resolve directory returns */</span></div>
<div class="line">    <span class="keywordflow">while</span> ((elem = strstr(path, DIRSEP_S <span class="stringliteral">&quot;..&quot;</span> DIRSEP_S)) != NULL ||</div>
<div class="line">        ((elem = strstr(path, DIRSEP_S <span class="stringliteral">&quot;..&quot;</span>)) != NULL &amp;&amp; elem[3] == <span class="charliteral">&#39;\0&#39;</span>)) {</div>
<div class="line">        <span class="keywordtype">char</span> *prev_comp = find_prev_path_sep(path, elem);</div>
<div class="line">        <span class="keywordflow">if</span> (prev_comp == NULL) {</div>
<div class="line">            <span class="comment">/* Reached start of string - cannot remove anymore */</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        memmove(prev_comp, &amp;elem[3], strlen(&amp;elem[3]) + 1);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">file2str(<span class="keyword">const</span> <span class="keywordtype">char</span> *comp, ...)</div>
<div class="line">{</div>
<div class="line">    va_list ap;</div>
<div class="line">    <span class="keywordtype">char</span> *filename, *str;</div>
<div class="line">    <span class="keywordtype">long</span> len;</div>
<div class="line"> </div>
<div class="line">    va_start(ap, comp);</div>
<div class="line">    filename = mkpathname_v(comp, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line">    str = file2str_name(&amp;len, filename);</div>
<div class="line">    free(filename);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">file2str_ext(<span class="keywordtype">long</span> *len_p, <span class="keyword">const</span> <span class="keywordtype">char</span> *comp, ...)</div>
<div class="line">{</div>
<div class="line">    va_list ap;</div>
<div class="line">    <span class="keywordtype">char</span> *filename, *str;</div>
<div class="line"> </div>
<div class="line">    va_start(ap, comp);</div>
<div class="line">    filename = mkpathname_v(comp, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line">    str = file2str_name(len_p, filename);</div>
<div class="line">    free(filename);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">char</span> *</div>
<div class="line">file2str_name(<span class="keywordtype">long</span> *len_p, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define MAX_FILESIZE    (256 &lt;&lt; 20) </span><span class="comment">/* 256MB */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordtype">char</span> *contents;</div>
<div class="line">    FILE *fp;</div>
<div class="line">    <span class="keywordtype">long</span> len;</div>
<div class="line"> </div>
<div class="line">    fp = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (fp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line"> </div>
<div class="line">    fseek(fp, 0, SEEK_END);</div>
<div class="line">    len = ftell(fp);</div>
<div class="line">    <span class="keywordflow">if</span> (len &lt; 0 || len &gt; MAX_FILESIZE) {</div>
<div class="line">        fclose(fp);</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line">    fseek(fp, 0, SEEK_SET);</div>
<div class="line">    contents = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(len + 1);</div>
<div class="line">    contents[len] = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (fread(contents, 1, len, fp) != (<span class="keywordtype">size_t</span>)len) {</div>
<div class="line">        fclose(fp);</div>
<div class="line">        free(contents);</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line">    fclose(fp);</div>
<div class="line">    *len_p = len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (contents);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">void</span> *</div>
<div class="line">file2buf(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, <span class="keywordtype">size_t</span> *bufsz)</div>
<div class="line">{</div>
<div class="line">    ssize_t s;</div>
<div class="line">    <span class="keywordtype">void</span> *buf;</div>
<div class="line">    FILE *fp = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fp == NULL) {</div>
<div class="line">        *bufsz = 0;</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line">    fseek(fp, 0, SEEK_END);</div>
<div class="line">    s = ftell(fp);</div>
<div class="line">    <span class="keywordflow">if</span> (s &lt;= 0) {</div>
<div class="line">        *bufsz = 0;</div>
<div class="line">        fclose(fp);</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line">    fseek(fp, 0, SEEK_SET);</div>
<div class="line"> </div>
<div class="line">    buf = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(s);</div>
<div class="line">    <span class="keywordflow">if</span> (fread(buf, 1, s, fp) &lt; (<span class="keywordtype">size_t</span>)s) {</div>
<div class="line">        *bufsz = 0;</div>
<div class="line">        free(buf);</div>
<div class="line">        fclose(fp);</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    fclose(fp);</div>
<div class="line">    *bufsz = s;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (buf);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">ssize_t</div>
<div class="line">filesz(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line">    ssize_t s;</div>
<div class="line">    FILE *fp = fopen(filename, <span class="stringliteral">&quot;rb&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (fp == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    fseek(fp, 0, SEEK_END);</div>
<div class="line">    s = ftell(fp);</div>
<div class="line">    fclose(fp);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (s);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">win_perror(DWORD err, <span class="keyword">const</span> <span class="keywordtype">char</span> *fmt, ...)</div>
<div class="line">{</div>
<div class="line">    va_list ap;</div>
<div class="line">    LPSTR win_msg = NULL;</div>
<div class="line">    <span class="keywordtype">char</span> *caller_msg;</div>
<div class="line">    <span class="keywordtype">int</span> len;</div>
<div class="line"> </div>
<div class="line">    va_start(ap, fmt);</div>
<div class="line">    len = vsnprintf(NULL, 0, fmt, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line">    caller_msg = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>(len + 1);</div>
<div class="line">    va_start(ap, fmt);</div>
<div class="line">    vsnprintf(caller_msg, len + 1, fmt, ap);</div>
<div class="line">    va_end(ap);</div>
<div class="line"> </div>
<div class="line">    (void) FormatMessageA(FORMAT_MESSAGE_ALLOCATE_BUFFER |</div>
<div class="line">        FORMAT_MESSAGE_FROM_SYSTEM | FORMAT_MESSAGE_IGNORE_INSERTS,</div>
<div class="line">        NULL, err, MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT),</div>
<div class="line">        (LPSTR)&amp;win_msg, 0, NULL);</div>
<div class="line">    strip_space(win_msg);</div>
<div class="line">    logMsg(<span class="stringliteral">&quot;%s: %s&quot;</span>, caller_msg, win_msg);</div>
<div class="line"> </div>
<div class="line">    free(caller_msg);</div>
<div class="line">    LocalFree(win_msg);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* IBM */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Returns true if the file exists. If `isdir&#39; is non-NULL, if the file</span></div>
<div class="line"><span class="comment"> * exists, isdir is set to indicate if the file is a directory.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">bool_t</div>
<div class="line">file_exists(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, bool_t *isdir)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line">    <span class="keywordtype">int</span> len = strlen(filename);</div>
<div class="line">    TCHAR filenameT[len + 1];</div>
<div class="line">    DWORD attr;</div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, filename, -1, filenameT, len + 1);</div>
<div class="line">    attr = GetFileAttributes(filenameT);</div>
<div class="line">    <span class="keywordflow">if</span> (isdir != NULL)</div>
<div class="line">        *isdir = !!(attr &amp; FILE_ATTRIBUTE_DIRECTORY);</div>
<div class="line">    <span class="keywordflow">if</span> (attr == INVALID_FILE_ATTRIBUTES) {</div>
<div class="line">        errno = ENOENT; <span class="comment">/* fake an errno value */</span></div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keyword">struct </span>stat st;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (isdir != NULL)</div>
<div class="line">        *isdir = B_FALSE;</div>
<div class="line">    <span class="keywordflow">if</span> (stat(filename, &amp;st) &lt; 0) {</div>
<div class="line">        <span class="keywordflow">if</span> (errno != ENOENT)</div>
<div class="line">            logMsg(<span class="stringliteral">&quot;Error checking if file %s exists: %s&quot;</span>,</div>
<div class="line">                filename, strerror(errno));</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (isdir != NULL)</div>
<div class="line">        *isdir = S_ISDIR(st.st_mode);</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Creates an empty directory at `dirname&#39; with default permissions.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">bool_t</div>
<div class="line">create_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> *dirname)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(dirname != NULL);</div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line">    DWORD err;</div>
<div class="line">    <span class="keywordtype">int</span> len = strlen(dirname);</div>
<div class="line">    WCHAR dirnameW[len + 1];</div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, dirname, -1, dirnameW, len + 1);</div>
<div class="line">    <span class="keywordflow">if</span> (!CreateDirectory(dirnameW, NULL) &amp;&amp;</div>
<div class="line">        (err = GetLastError()) != ERROR_ALREADY_EXISTS) {</div>
<div class="line">        win_perror(err, <span class="stringliteral">&quot;Error creating directory %s&quot;</span>, dirname);</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span> (mkdir(dirname, 0777) != 0 &amp;&amp; errno != EEXIST) {</div>
<div class="line">        logMsg(<span class="stringliteral">&quot;Error creating directory %s: %s&quot;</span>, dirname,</div>
<div class="line">            strerror(errno));</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Same as create_directory, but creates all intermediate directories</span></div>
<div class="line"><span class="comment"> * on the way as well.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">bool_t</div>
<div class="line">create_directory_recursive(<span class="keyword">const</span> <span class="keywordtype">char</span> *dirname)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">char</span> *partname = <a class="code" href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a>(1, strlen(dirname) + 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">const</span> <span class="keywordtype">char</span> *start = dirname, *end = strchr(&amp;dirname[1], DIRSEP);</div>
<div class="line">        end != NULL; start = end, end = strchr(&amp;start[1], DIRSEP)) {</div>
<div class="line">        strncat(partname, start, end - start);</div>
<div class="line">        <span class="keywordflow">if</span> (!create_directory(partname))</div>
<div class="line">            <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    free(partname);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (create_directory(dirname));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> bool_t</div>
<div class="line">win_rmdir(<span class="keyword">const</span> LPTSTR dirnameT)</div>
<div class="line">{</div>
<div class="line">    WIN32_FIND_DATA find_data;</div>
<div class="line">    HANDLE h_find;</div>
<div class="line">    <span class="keywordtype">int</span> dirname_len = wcslen(dirnameT);</div>
<div class="line">    TCHAR srchnameT[dirname_len + 4];</div>
<div class="line"> </div>
<div class="line">    StringCchPrintf(srchnameT, dirname_len + 4, TEXT(<span class="stringliteral">&quot;%s\\*&quot;</span>), dirnameT);</div>
<div class="line">    h_find = FindFirstFile(srchnameT, &amp;find_data);</div>
<div class="line">    <span class="keywordflow">if</span> (h_find == INVALID_HANDLE_VALUE) {</div>
<div class="line">        <span class="keywordtype">int</span> err = GetLastError();</div>
<div class="line">        <span class="keywordtype">char</span> dirname[MAX_PATH];</div>
<div class="line">        WideCharToMultiByte(CP_UTF8, 0, dirnameT, -1, dirname,</div>
<div class="line">            <span class="keyword">sizeof</span> (dirname), NULL, NULL);</div>
<div class="line">        win_perror(err, <span class="stringliteral">&quot;Error listing directory %s&quot;</span>, dirname);</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        TCHAR filepathT[MAX_PATH];</div>
<div class="line">        DWORD attrs;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (wcscmp(find_data.cFileName, TEXT(<span class="stringliteral">&quot;.&quot;</span>)) == 0 ||</div>
<div class="line">            wcscmp(find_data.cFileName, TEXT(<span class="stringliteral">&quot;..&quot;</span>)) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        StringCchPrintf(filepathT, MAX_PATH, TEXT(<span class="stringliteral">&quot;%s\\%s&quot;</span>), dirnameT,</div>
<div class="line">            find_data.cFileName);</div>
<div class="line">        attrs = GetFileAttributes(filepathT);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (attrs &amp; FILE_ATTRIBUTE_DIRECTORY) {</div>
<div class="line">            <span class="keywordflow">if</span> (!win_rmdir(filepathT))</div>
<div class="line">                <span class="keywordflow">goto</span> errout;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="keywordflow">if</span> (!DeleteFile(filepathT)) {</div>
<div class="line">                <span class="keywordtype">char</span> filepath[MAX_PATH];</div>
<div class="line">                WideCharToMultiByte(CP_UTF8, 0, filepathT, -1,</div>
<div class="line">                    filepath, <span class="keyword">sizeof</span> (filepath), NULL, NULL);</div>
<div class="line">                win_perror(GetLastError(), <span class="stringliteral">&quot;Error removing &quot;</span></div>
<div class="line">                    <span class="stringliteral">&quot;file %s&quot;</span>, filepath);</div>
<div class="line">                <span class="keywordflow">goto</span> errout;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (FindNextFile(h_find, &amp;find_data));</div>
<div class="line">    FindClose(h_find);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!RemoveDirectory(dirnameT)) {</div>
<div class="line">        <span class="keywordtype">char</span> dirname[MAX_PATH];</div>
<div class="line">        WideCharToMultiByte(CP_UTF8, 0, dirnameT, -1,</div>
<div class="line">            dirname, <span class="keyword">sizeof</span> (dirname), NULL, NULL);</div>
<div class="line">        win_perror(GetLastError(), <span class="stringliteral">&quot;Error removing directory %s&quot;</span>,</div>
<div class="line">            dirname);</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">errout:</div>
<div class="line">    FindClose(h_find);</div>
<div class="line">    <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* IBM */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment"> * Recursive directory removal, including all its contents.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line">bool_t</div>
<div class="line">remove_directory(<span class="keyword">const</span> <span class="keywordtype">char</span> *dirname)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line">    TCHAR dirnameT[strlen(dirname) + 1];</div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, dirname, -1, dirnameT,</div>
<div class="line">        <span class="keyword">sizeof</span> (dirnameT));</div>
<div class="line">    <span class="keywordflow">return</span> (win_rmdir(dirnameT));</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    DIR *dp;</div>
<div class="line">    <span class="keyword">struct </span>dirent *de;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> ((dp = opendir(dirname)) == NULL) {</div>
<div class="line">        logMsg(<span class="stringliteral">&quot;Error removing directory %s: %s&quot;</span>, dirname,</div>
<div class="line">            strerror(errno));</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">while</span> ((de = readdir(dp)) != NULL) {</div>
<div class="line">        <span class="keywordtype">char</span> filename[FILENAME_MAX];</div>
<div class="line">        <span class="keywordtype">int</span> err;</div>
<div class="line">        <span class="keyword">struct </span>stat st;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (strcmp(de-&gt;d_name, <span class="stringliteral">&quot;.&quot;</span>) == 0 ||</div>
<div class="line">            strcmp(de-&gt;d_name, <span class="stringliteral">&quot;..&quot;</span>) == 0)</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (snprintf(filename, <span class="keyword">sizeof</span> (filename), <span class="stringliteral">&quot;%s/%s&quot;</span>, dirname,</div>
<div class="line">            de-&gt;d_name) &gt;= (ssize_t)sizeof (filename)) {</div>
<div class="line">            logMsg(<span class="stringliteral">&quot;Error removing directory %s: path too long&quot;</span>,</div>
<div class="line">                dirname);</div>
<div class="line">            <span class="keywordflow">goto</span> errout;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (lstat(filename, &amp;st) &lt; 0) {</div>
<div class="line">            logMsg(<span class="stringliteral">&quot;Error removing directory %s: cannot stat &quot;</span></div>
<div class="line">                <span class="stringliteral">&quot;file %s: %s&quot;</span>, dirname, de-&gt;d_name,</div>
<div class="line">                strerror(errno));</div>
<div class="line">            <span class="keywordflow">goto</span> errout;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (S_ISDIR(st.st_mode)) {</div>
<div class="line">            <span class="keywordflow">if</span> (!remove_directory(filename))</div>
<div class="line">                <span class="keywordflow">goto</span> errout;</div>
<div class="line">            err = 0;</div>
<div class="line">        } <span class="keywordflow">else</span> {</div>
<div class="line">            err = unlink(filename);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span> (err != 0) {</div>
<div class="line">            logMsg(<span class="stringliteral">&quot;Error removing %s: %s&quot;</span>, filename,</div>
<div class="line">                strerror(errno));</div>
<div class="line">            <span class="keywordflow">goto</span> errout;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    closedir(dp);</div>
<div class="line">    <span class="keywordflow">if</span> (rmdir(dirname) != 0) {</div>
<div class="line">        logMsg(<span class="stringliteral">&quot;Error removing %s: %s&quot;</span>, dirname, strerror(errno));</div>
<div class="line">        <span class="keywordflow">goto</span> errout;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line">errout:</div>
<div class="line">    closedir(dp);</div>
<div class="line">    <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">bool_t</div>
<div class="line">remove_file(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, bool_t notfound_ok)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line">    TCHAR filenameT[strlen(filename) + 1];</div>
<div class="line">    DWORD error;</div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, filename, -1, filenameT,</div>
<div class="line">        <span class="keyword">sizeof</span> (filenameT));</div>
<div class="line">    <span class="keywordflow">if</span> (!DeleteFile(filenameT) &amp;&amp; ((error = GetLastError()) !=</div>
<div class="line">        ERROR_FILE_NOT_FOUND || !notfound_ok)) {</div>
<div class="line">        win_perror(error, <span class="stringliteral">&quot;Cannot remove file %s&quot;</span>, filename);</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line"><span class="preprocessor">#else   </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span> (unlink(filename) &lt; 0 &amp;&amp; (errno != ENOENT || !notfound_ok)) {</div>
<div class="line">        logMsg(<span class="stringliteral">&quot;Cannot remove file %s: %s&quot;</span>, filename, strerror(errno));</div>
<div class="line">        <span class="keywordflow">return</span> (B_FALSE);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> (B_TRUE);</div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* !IBM */</span><span class="preprocessor"></span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">API_EXPORT <span class="keywordtype">char</span> *</div>
<div class="line">lacf_dirname(<span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> l = strlen(filename);</div>
<div class="line">    <span class="keywordtype">char</span> *p1, *p2;</div>
<div class="line">    <span class="keywordtype">char</span> *str;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (l == 0)</div>
<div class="line">        <span class="keywordflow">return</span> (strdup(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line"> </div>
<div class="line">    p1 = strrchr(filename, <span class="charliteral">&#39;/&#39;</span>);</div>
<div class="line">    p2 = strrchr(filename, <span class="charliteral">&#39;\\&#39;</span>);</div>
<div class="line">    p1 = MAX(p1, p2);</div>
<div class="line">    <span class="keywordflow">if</span> (p1 == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> (strdup(<span class="stringliteral">&quot;&quot;</span>));</div>
<div class="line">    str = <a class="code" href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a>((p1 - filename) + 1);</div>
<div class="line">    lacf_strlcpy(str, filename, (p1 - filename) + 1);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (str);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if IBM</span></div>
<div class="line"> </div>
<div class="line">DIR *</div>
<div class="line">opendir(<span class="keyword">const</span> <span class="keywordtype">char</span> *path)</div>
<div class="line">{</div>
<div class="line">    DIR *dirp = <a class="code" href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a>(1, <span class="keyword">sizeof</span> (*dirp));</div>
<div class="line">    TCHAR   pathT[strlen(path) + 3];    <span class="comment">/* For &#39;\*&#39; at the end */</span></div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, path, -1, pathT, <span class="keyword">sizeof</span> (pathT));</div>
<div class="line">    StringCchCat(pathT, <span class="keyword">sizeof</span> (pathT), TEXT(<span class="stringliteral">&quot;\\*&quot;</span>));</div>
<div class="line">    dirp-&gt;handle = FindFirstFile(pathT, &amp;dirp-&gt;find_data);</div>
<div class="line">    <span class="keywordflow">if</span> (dirp-&gt;handle == INVALID_HANDLE_VALUE) {</div>
<div class="line">        win_perror(GetLastError(), <span class="stringliteral">&quot;Cannot open directory %s&quot;</span>, path);</div>
<div class="line">        free(dirp);</div>
<div class="line">        <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    }</div>
<div class="line">    dirp-&gt;first = B_TRUE;</div>
<div class="line">    <span class="keywordflow">return</span> (dirp);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>dirent *</div>
<div class="line">readdir(DIR *dirp)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">/* First call to readdir retrieves what we got from FindFirstFile */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!dirp-&gt;first) {</div>
<div class="line">        <span class="keywordflow">if</span> (FindNextFile(dirp-&gt;handle, &amp;dirp-&gt;find_data) == 0)</div>
<div class="line">            <span class="keywordflow">return</span> (NULL);</div>
<div class="line">    } <span class="keywordflow">else</span> {</div>
<div class="line">        dirp-&gt;first = B_FALSE;</div>
<div class="line">    }</div>
<div class="line">    WideCharToMultiByte(CP_UTF8, 0, dirp-&gt;find_data.cFileName, -1,</div>
<div class="line">        dirp-&gt;de.d_name, sizeof (dirp-&gt;de.d_name), NULL, NULL);</div>
<div class="line">    <span class="keywordflow">return</span> (&amp;dirp-&gt;de);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">closedir(DIR *dirp)</div>
<div class="line">{</div>
<div class="line">    FindClose(dirp-&gt;handle);</div>
<div class="line">    free(dirp);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">stat(<span class="keyword">const</span> <span class="keywordtype">char</span> *pathname, <span class="keyword">struct</span> stat *buf)</div>
<div class="line">{</div>
<div class="line">    FILETIME    wtime, atime;</div>
<div class="line">    HANDLE      fh;</div>
<div class="line">    TCHAR       pathnameT[strlen(pathname) + 1];</div>
<div class="line">    LARGE_INTEGER   sz;</div>
<div class="line">    ULARGE_INTEGER  ftime;</div>
<div class="line">    bool_t      isdir;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!file_exists(pathname, &amp;isdir)) {</div>
<div class="line">        logMsg(<span class="stringliteral">&quot;Cannot stat %s: no such file or directory&quot;</span>, pathname);</div>
<div class="line">        errno = ENOENT;</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    MultiByteToWideChar(CP_UTF8, 0, pathname, -1, pathnameT,</div>
<div class="line">        <span class="keyword">sizeof</span> (pathnameT));</div>
<div class="line">    fh = CreateFile(pathnameT, (!isdir ? FILE_READ_ATTRIBUTES : 0) |</div>
<div class="line">        GENERIC_READ, FILE_SHARE_READ, NULL, OPEN_EXISTING, 0, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (fh == INVALID_HANDLE_VALUE ||</div>
<div class="line">        !GetFileTime(fh, NULL, &amp;atime, &amp;wtime) ||</div>
<div class="line">        (!isdir &amp;&amp; !GetFileSizeEx(fh, &amp;sz))) {</div>
<div class="line">        win_perror(GetLastError(), <span class="stringliteral">&quot;Cannot stat %s&quot;</span>, pathname);</div>
<div class="line">        errno = EACCES;</div>
<div class="line">        <span class="keywordflow">return</span> (-1);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">if</span> (isdir)</div>
<div class="line">        buf-&gt;st_size = 0;</div>
<div class="line">    <span class="keywordflow">else</span></div>
<div class="line">        buf-&gt;st_size = sz.QuadPart;</div>
<div class="line"> </div>
<div class="line">    ftime.LowPart = atime.dwLowDateTime;</div>
<div class="line">    ftime.HighPart = atime.dwHighDateTime;</div>
<div class="line">    buf-&gt;st_atime = ftime.QuadPart / 10000000ull - 11644473600ull;</div>
<div class="line"> </div>
<div class="line">    ftime.LowPart = wtime.dwLowDateTime;</div>
<div class="line">    ftime.HighPart = wtime.dwHighDateTime;</div>
<div class="line">    buf-&gt;st_mtime = ftime.QuadPart / 10000000ull - 11644473600ull;</div>
<div class="line"> </div>
<div class="line">    CloseHandle(fh);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (0);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif  </span><span class="comment">/* IBM */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">size_t</span></div>
<div class="line">qsort_partition(<span class="keywordtype">void</span> *base, <span class="keywordtype">long</span> lo, <span class="keywordtype">long</span> hi, <span class="keywordtype">size_t</span> size,</div>
<div class="line">    <span class="keywordtype">int</span> (*compar)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#define SWAP(i, j) \</span></div>
<div class="line"><span class="preprocessor">    do { \</span></div>
<div class="line"><span class="preprocessor">        uint8_t tmp[size]; \</span></div>
<div class="line"><span class="preprocessor">        memcpy(tmp, base + size * (i), size); \</span></div>
<div class="line"><span class="preprocessor">        memcpy(base + size * (i), base + size * (j), size); \</span></div>
<div class="line"><span class="preprocessor">        memcpy(base + size * (j), tmp, size); \</span></div>
<div class="line"><span class="preprocessor">    } while (0)</span></div>
<div class="line">    <span class="keywordtype">void</span> *pivot = base + hi * size;</div>
<div class="line">    <span class="keywordtype">long</span> i = lo;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">long</span> j = lo; j &lt; hi; j++) {</div>
<div class="line">        <span class="keywordflow">if</span> (compar(base + j * size, pivot, arg) &lt; 0) {</div>
<div class="line">            SWAP(i, j);</div>
<div class="line">            i++;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    SWAP(i, hi);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> (i);</div>
<div class="line"><span class="preprocessor">#undef  SWAP</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">qsort_r_impl(<span class="keywordtype">void</span> *base, <span class="keywordtype">long</span> lo, <span class="keywordtype">long</span> hi, <span class="keywordtype">size_t</span> size,</div>
<div class="line">    <span class="keywordtype">int</span> (*compar)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (lo &lt; hi) {</div>
<div class="line">        <span class="keywordtype">long</span> p = qsort_partition(base, lo, hi, size, compar, arg);</div>
<div class="line"> </div>
<div class="line">        qsort_r_impl(base, lo, p - 1, size, compar, arg);</div>
<div class="line">        qsort_r_impl(base, p + 1, hi, size, compar, arg);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">lacf_qsort_r(<span class="keywordtype">void</span> *base, <span class="keywordtype">size_t</span> nmemb, <span class="keywordtype">size_t</span> size,</div>
<div class="line">    <span class="keywordtype">int</span> (*compar)(<span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keyword">const</span> <span class="keywordtype">void</span> *, <span class="keywordtype">void</span> *), <span class="keywordtype">void</span> *arg)</div>
<div class="line">{</div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(compar != NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (nmemb != 0) {</div>
<div class="line">        <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(base != NULL);</div>
<div class="line">        qsort_r_impl(base, 0, nmemb - 1, size, compar, arg);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span></div>
<div class="line">lacf_strlcpy(<span class="keywordtype">char</span> *restrict dest, <span class="keyword">const</span> <span class="keywordtype">char</span> *restrict src, <span class="keywordtype">size_t</span> cap)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> l;</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a>(cap != 0);</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * We MUSTN&#39;T use strlen here, because src may be SIGNIFICANTLY</span></div>
<div class="line"><span class="comment">     * larger than dest and we don&#39;t want to measure the ENTIRE body</span></div>
<div class="line"><span class="comment">     * of src. We only care for length UP TO the destination capacity.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    <span class="keywordflow">for</span> (l = 0; l + 1 &lt; cap &amp;&amp; src[l] != <span class="charliteral">&#39;\0&#39;</span>; l++)</div>
<div class="line">        ;</div>
<div class="line">    <span class="comment">/*</span></div>
<div class="line"><span class="comment">     * Due to a bug in GCC, we can&#39;t use strncpy, as it sometimes throws</span></div>
<div class="line"><span class="comment">     * &quot;call to __builtin___strncpy_chk will always overflow destination</span></div>
<div class="line"><span class="comment">     * buffer&quot;, even when it&#39;s absolutely NOT the case.</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    memcpy(dest, src, MIN(cap - 1, l + 1));</div>
<div class="line">    <span class="comment">/* Insure the string is ALWAYS terminated */</span></div>
<div class="line">    dest[cap - 1] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aassert_8h_html"><div class="ttname"><a href="assert_8h.html">assert.h</a></div></div>
<div class="ttc" id="aassert_8h_html_a26960017b3b93ae2f2025c5a4bb06493"><div class="ttname"><a href="assert_8h.html#a26960017b3b93ae2f2025c5a4bb06493">ASSERT_MSG</a></div><div class="ttdeci">#define ASSERT_MSG(x, fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="assert_8h_source.html#l00198">assert.h:198</a></div></div>
<div class="ttc" id="aassert_8h_html_aca68c0d4ac8df0838e209fb5300f7be3"><div class="ttname"><a href="assert_8h.html#aca68c0d4ac8df0838e209fb5300f7be3">ASSERT</a></div><div class="ttdeci">#define ASSERT(x)</div><div class="ttdef"><b>Definition:</b> <a href="assert_8h_source.html#l00192">assert.h:192</a></div></div>
<div class="ttc" id="aassert_8h_html_ad1382f354d22108a9b483f437eac5536"><div class="ttname"><a href="assert_8h.html#ad1382f354d22108a9b483f437eac5536">VERIFY3S</a></div><div class="ttdeci">#define VERIFY3S(x, op, y)</div><div class="ttdef"><b>Definition:</b> <a href="assert_8h_source.html#l00125">assert.h:125</a></div></div>
<div class="ttc" id="aassert_8h_html_ad157a1a262c174b8a8744896359009b7"><div class="ttname"><a href="assert_8h.html#ad157a1a262c174b8a8744896359009b7">VERIFY_MSG</a></div><div class="ttdeci">#define VERIFY_MSG(x, fmt,...)</div><div class="ttdef"><b>Definition:</b> <a href="assert_8h_source.html#l00091">assert.h:91</a></div></div>
<div class="ttc" id="ahelpers_8h_html"><div class="ttname"><a href="helpers_8h.html">helpers.h</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a126c9985207224b1487aa70bf8372e49"><div class="ttname"><a href="helpers_8h.html#a126c9985207224b1487aa70bf8372e49">airac_time2cycle</a></div><div class="ttdeci">int airac_time2cycle(time_t t)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00557">helpers.c:557</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a361e1a0df927839f8a04c9df79bbc15b"><div class="ttname"><a href="helpers_8h.html#a361e1a0df927839f8a04c9df79bbc15b">copy_rwy_ID</a></div><div class="ttdeci">void copy_rwy_ID(const char *src, char dst[4])</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00411">helpers.c:411</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a3c1a2e6f05dd84ac0b31464d12eeb4b5"><div class="ttname"><a href="helpers_8h.html#a3c1a2e6f05dd84ac0b31464d12eeb4b5">is_valid_icao_code</a></div><div class="ttdeci">bool_t is_valid_icao_code(const char *icao)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00312">helpers.c:312</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a3cb4d21bba429e71025889e0aea7b1d6"><div class="ttname"><a href="helpers_8h.html#a3cb4d21bba429e71025889e0aea7b1d6">explode_line</a></div><div class="ttdeci">ssize_t explode_line(char *line, char delim, char **comps, size_t capacity)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00588">helpers.c:588</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a4a2d6a9dd5dfa4e0cd9698020c81fc1f"><div class="ttname"><a href="helpers_8h.html#a4a2d6a9dd5dfa4e0cd9698020c81fc1f">airac_cycle2eff_date</a></div><div class="ttdeci">const char * airac_cycle2eff_date(int cycle)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00485">helpers.c:485</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a649de234cc792d4f96364245729ec4b1"><div class="ttname"><a href="helpers_8h.html#a649de234cc792d4f96364245729ec4b1">is_valid_loc_freq</a></div><div class="ttdeci">bool_t is_valid_loc_freq(double freq_mhz)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00261">helpers.c:261</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a7506407dd76baea064f50cb0caa9e7f6"><div class="ttname"><a href="helpers_8h.html#a7506407dd76baea064f50cb0caa9e7f6">is_valid_vor_freq</a></div><div class="ttdeci">bool_t is_valid_vor_freq(double freq_mhz)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00233">helpers.c:233</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a77793777dd754d167695308feae78833"><div class="ttname"><a href="helpers_8h.html#a77793777dd754d167695308feae78833">is_valid_ndb_freq</a></div><div class="ttdeci">bool_t is_valid_ndb_freq(double freq_khz)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00297">helpers.c:297</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a7c9d440c0119c02b39eaf28f902118e9"><div class="ttname"><a href="helpers_8h.html#a7c9d440c0119c02b39eaf28f902118e9">is_valid_hdg</a></div><div class="ttdeci">static bool_t is_valid_hdg(double hdg)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8h_source.html#l00168">helpers.h:168</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a88cfba22243cc7fac93e890adfd16adb"><div class="ttname"><a href="helpers_8h.html#a88cfba22243cc7fac93e890adfd16adb">extract_icao_country_code</a></div><div class="ttdeci">const char * extract_icao_country_code(const char *icao)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00358">helpers.c:358</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a8f87ba6dc040d945474f832594982717"><div class="ttname"><a href="helpers_8h.html#a8f87ba6dc040d945474f832594982717">is_valid_tacan_freq</a></div><div class="ttdeci">bool_t is_valid_tacan_freq(double freq_mhz)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00280">helpers.c:280</a></div></div>
<div class="ttc" id="ahelpers_8h_html_a99a82d2bf808f14f113bb5fd787d780a"><div class="ttname"><a href="helpers_8h.html#a99a82d2bf808f14f113bb5fd787d780a">airac_cycle2exp_date</a></div><div class="ttdeci">bool_t airac_cycle2exp_date(int cycle, char buf[16], time_t *cycle_end_p)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00526">helpers.c:526</a></div></div>
<div class="ttc" id="ahelpers_8h_html_aab2e0b814c99c025f8f9f104fbc2524b"><div class="ttname"><a href="helpers_8h.html#aab2e0b814c99c025f8f9f104fbc2524b">rel_hdg_impl</a></div><div class="ttdeci">double rel_hdg_impl(double hdg1, double hdg2, const char *file, int line)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00194">helpers.c:194</a></div></div>
<div class="ttc" id="ahelpers_8h_html_ab16fce6a4a8867f5fb5415c6c291f2b7"><div class="ttname"><a href="helpers_8h.html#ab16fce6a4a8867f5fb5415c6c291f2b7">is_valid_rwy_ID</a></div><div class="ttdeci">bool_t is_valid_rwy_ID(const char *rwy_ID)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00379">helpers.c:379</a></div></div>
<div class="ttc" id="ahelpers_8h_html_ac1d25f92a294583c6464dead6d76d486"><div class="ttname"><a href="helpers_8h.html#ac1d25f92a294583c6464dead6d76d486">airac_cycle2eff_date2</a></div><div class="ttdeci">time_t airac_cycle2eff_date2(int cycle)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00499">helpers.c:499</a></div></div>
<div class="ttc" id="ahelpers_8h_html_ac42646e74896317edfba4743494c72d2"><div class="ttname"><a href="helpers_8h.html#ac42646e74896317edfba4743494c72d2">is_valid_xpdr_code</a></div><div class="ttdeci">bool_t is_valid_xpdr_code(int code)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00217">helpers.c:217</a></div></div>
<div class="ttc" id="ahelpers_8h_html_aef0696611004600a10d0ff68f92f235b"><div class="ttname"><a href="helpers_8h.html#aef0696611004600a10d0ff68f92f235b">is_valid_iata_code</a></div><div class="ttdeci">bool_t is_valid_iata_code(const char *iata)</div><div class="ttdef"><b>Definition:</b> <a href="helpers_8c_source.html#l00336">helpers.c:336</a></div></div>
<div class="ttc" id="asafe__alloc_8h_html"><div class="ttname"><a href="safe__alloc_8h.html">safe_alloc.h</a></div></div>
<div class="ttc" id="asafe__alloc_8h_html_a7548137d093d63064f1972b9d160ff74"><div class="ttname"><a href="safe__alloc_8h.html#a7548137d093d63064f1972b9d160ff74">safe_malloc</a></div><div class="ttdeci">static void * safe_malloc(size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="safe__alloc_8h_source.html#l00047">safe_alloc.h:47</a></div></div>
<div class="ttc" id="asafe__alloc_8h_html_a8d9fda542019d718b3566ba4f01800c1"><div class="ttname"><a href="safe__alloc_8h.html#a8d9fda542019d718b3566ba4f01800c1">safe_calloc</a></div><div class="ttdeci">static void * safe_calloc(size_t nmemb, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="safe__alloc_8h_source.html#l00062">safe_alloc.h:62</a></div></div>
<div class="ttc" id="asafe__alloc_8h_html_a9f32a56587b5252c01a2304b3e44d658"><div class="ttname"><a href="safe__alloc_8h.html#a9f32a56587b5252c01a2304b3e44d658">safe_realloc</a></div><div class="ttdeci">static void * safe_realloc(void *oldptr, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="safe__alloc_8h_source.html#l00077">safe_alloc.h:77</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
