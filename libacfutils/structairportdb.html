<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libacfutils: airportdb Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libacfutils
   </div>
   <div id="projectbrief">A general purpose library of utility functions designed to make it easier to develop addons for the X-Plane flight simulator.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">airportdb Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>The airport database is the primary repository of knowledge about airports, runways and bounding boxes. It is composed of two data structures:</p>
<ul>
<li>a global ident -&gt; airport_t AVL tree (apt_dat). This allows us to quickly locate an airport based on its identifier.</li>
<li>a geo-referenced AVL tree from approximate airport reference point position (in 1-degree accuracy) to the airport_t (geo_table). This allows us to quickly sift through the airport database to locate any airports close to a given point of interest.</li>
</ul>
<p>Of these, apt_dat is the primary repository of knowledge - once an airport is gone from apt_dat, it is freed. An airport may or may not be geo-referenced in the geo_table. Once all loading of an airport is complete, it WILL be geo-referenced.</p>
<p>The geo_table is actually comprised of tile_t data structures. A tile_t refers to a 1x1 degree geographical tile at specific coordinates and contains its own private airport_t tree, which is again organized by abstract identifier, allowing us to step through all the airports in a tile or quickly locate one based on identifier.</p>
<p>During normal operation, not all airports from all over the world are loaded into memory, as that would use quite a bit of memory and delay startup. Instead, only the closets 9 tiles around the aircraft are present. New tiles are loaded as the aircraft repositions and the old ones are released. Loading a tile first populates the global apt_dat with all its airports, which are then geo-referenced in the newly created tile. Releasing a tile is the converse, ultimately ending in the airports being purged from apt_dat and freed.</p>
<p>The 9-tile rule can result in strange behavior close to the poles, where the code might think of close by airports as being very far away and thus not load them. Luckily, there are only about 4 airports beyond 80 degrees latitude (north or south), all of which are very special non-regular airports, so we just ignore those.</p>
<p>AIRPORT DATA CONSTRUCTION METHOD</p>
<p>For each airport, we need to obtain the following pieces of information:</p>
<ol type="1">
<li>The abstract airport identifier.<ul>
<li>Optional ICAO identifier, on a 1302 icao_code line.</li>
<li>Optional IATA identifier, on a 1302 iata_code line.</li>
</ul>
</li>
<li>The airport reference point latitude, longitude and elevation.</li>
<li>The airport's transition altitude and transition level (if published).</li>
<li>For each runway:<ul>
<li>Runway width.</li>
<li>Each threshold's geographical position and elevation.</li>
<li>If the threshold is displaced, the amount of displacement.</li>
<li>For each end, if available, the optimal glidepath angle and threshold clearing height.</li>
</ul>
</li>
</ol>
<p>First we examine all installed scenery. That means going through each apt.dat declared in scenery_packs.ini and the global default apt dat to find these kinds of records:</p>
<ul>
<li>'1' records identify airports. See parse_apt_dat_1_line.</li>
<li>'21' records identify runway-related lighting fixtures (PAPIs/VASIs). See parse_apt_dat_21_line.</li>
<li>'50' through '56' and '1050' through '1056' records identify frequency information. See parse_apt_dat_freq_line.</li>
<li>'100' records identify runways. See parse_apt_dat_100_line.</li>
<li>'1302' records identify airport meta-information, such as ICAO code, TA, TL, reference point location, etc.</li>
</ul>
<p>Prior to X-Plane 11, apt.dat's didn't necessarily contain the '1302' records, so we had to pull those from the Airports.txt in the navdata directory for the built-in GNS430. Starting from X-Plane 11, Airports.txt is gone and this data has been relocated to the apt.dat.</p>
<p>A further complication of the absence of an Airports.txt is that this file contained both the GPA and TCH for each runway and although it did sometimes require some fuzzy matching to account for outdated scenery not exactly matching the navdata, we could obtain this information from one place.</p>
<p>So for X-Plane 11, we've implemented a new method of obtaining this information. By default, if a runway has an instrument approach (unless ifr_only=B_FALSE), it will have an entry in CIFP. Runway entries in APPCH-type procedures specify the TCH and GPA in columns 24 and 29 (ARINC 424 fields 4.1.9.1.85-89 and 4.1.9.1.103-106). We only use the first such occurence. If there are multiple approaches to the runway, they should all end up with the same TCH and GPA. This should cover pretty much every case. In the rare case where we <em>don't</em> get the TCH and GPA this way, we try a fallback mechanism. Almost every instrument approach runway has some kind of visual glideslope indication (VGSI) right next to it. We can extract the location of those from the apt.dat file. These VGSIs are located in the exact touchdown point and have a fixed GPA. So we simply look for a VGSI close to the runway's centerline and that is aligned with the runway, compute the longitudinal displacement of this indicator from the runway threshold and using the indicator's GPA compute the optimal TCH. </p>
</div><hr/>The documentation for this struct was generated from the following file:<ul>
<li>/home/diablos/NextDev/libacfutils-dll/src/<a class="el" href="airportdb_8c_source.html">airportdb.c</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
